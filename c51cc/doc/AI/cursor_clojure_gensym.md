# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –≤ Clojure
_Exported on 5/27/2025 at 20:44:32 GMT+3 from Cursor (0.50.5)_

---

**User**

1. –ú—ã –≤–Ω–µ—Å–ª–∏ –º–Ω–æ–≥–æ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –º—ã –Ω–µ –≤–Ω–µ—Å–ª–∏ callback hell
2. –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–ª–∞—Å—å –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è cond –∫–æ–≥–¥–∞ clojure —Å–∞–º –≤—ã–±–∏—Ä–∞–ª, –∫–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π —Ä–∞–¥–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è? –ß—Ç–æ-—Ç–æ —Ç–∏–ø–∞ swithc-case –¥–ª—è c, —Ç–æ–ª—å–∫–æ –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ

---

**Cursor**

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–¥ –∏ –æ—Ç–≤–µ—Ç–∏–º –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã.

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–¥ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç callback hell –∏ –æ—Ç–≤–µ—Ç–∏–º –Ω–∞ –≤—Ç–æ—Ä–æ–π –≤–æ–ø—Ä–æ—Å:

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å —è –º–æ–≥—É –¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ–±–∞ –≤–∞—à–∏—Ö –≤–æ–ø—Ä–æ—Å–∞.

## 1. –ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç Callback Hell

**–•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏! üéâ** –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –º—ã **—É—Å–ø–µ—à–Ω–æ –∏–∑–±–µ–∂–∞–ª–∏ callback hell**. –í–æ—Ç –ø–æ—á–µ–º—É:

### ‚úÖ –ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `do-parse` –º–∞–∫—Ä–æ—Å–∞** - –≤—Å–µ —Å–ª–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ª–∏–Ω–µ–π–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –≤–º–µ—Å—Ç–æ –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏:

```clojure
;; –ë–´–õ–û (callback hell):
(fn [state]
  (let [result1 (parser1 state)]
    (if (:success? result1)
      (let [result2 (parser2 (:state result1))]
        (if (:success? result2)
          (let [result3 (parser3 (:state result2))]
            ;; –µ—â–µ –±–æ–ª—å—à–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏...
            )))))))

;; –°–¢–ê–õ–û (–ª–∏–Ω–µ–π–Ω–æ –∏ —á–∏—Ç–∞–µ–º–æ):
(do-parse
  value1 parser1
  value2 parser2  
  value3 parser3
  (return-parser (combine value1 value2 value3)))
```

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã** - —Å–æ–∑–¥–∞–ª–∏ –Ω–∞–±–æ—Ä –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤—ã—Å—à–µ–≥–æ –ø–æ—Ä—è–¥–∫–∞:
   - `choice`, `many`, `optional`
   - `between`, `separated-by`, `comma-separated`
   - `parse-binary-expression-with-operators`

3. **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–ª–æ–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** –Ω–∞ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ:
   - `parse-function-call-args`
   - `parse-array-index`
   - `apply-postfix-operators`

### üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è:
- **–ì–ª—É–±–∏–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏**: —Å 7-8 —É—Ä–æ–≤–Ω–µ–π –¥–æ 1-2 —É—Ä–æ–≤–Ω–µ–π
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –∫–æ–¥ —Å—Ç–∞–ª –º–æ–¥—É–ª—å–Ω—ã–º –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º

## 2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ `cond` - —ç—Ç–æ **Multimethods** (`defmulti`/`defmethod`)

–í—ã –¥—É–º–∞–ª–∏ –æ **multimethods** - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ switch-case, –≥–¥–µ Clojure —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞:

```clojure
;; –ë–´–õ–û (callback hell):
(fn [state]
  (let [result1 (parser1 state)]
    (if (:success? result1)
      (let [result2 (parser2 (:state result1))]
        (if (:success? result2)
          (let [result3 (parser3 (:state result2))]
            ;; –µ—â–µ –±–æ–ª—å—à–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏...
            )))))))

;; –°–¢–ê–õ–û (–ª–∏–Ω–µ–π–Ω–æ –∏ —á–∏—Ç–∞–µ–º–æ):
(do-parse
  value1 parser1
  value2 parser2  
  value3 parser3
  (return-parser (combine value1 value2 value3)))
```

```clojure
(ns c51cc.parser-multimethods-demo
  "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è multimethods –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã cond
   –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞ –≤ –ø–∞—Ä—Å–µ—Ä–µ"
  (:require [c51cc.parser :as parser]))

;; ============================================================================
;; MULTIMETHODS - –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–ê–Ø –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê SWITCH-CASE
;; ============================================================================

;; –í–º–µ—Å—Ç–æ –≥—Ä–æ–º–æ–∑–¥–∫–æ–≥–æ cond:
;; (cond 
;;   (= token-type :number) (parse-number token)
;;   (= token-type :identifier) (parse-identifier token)
;;   (= token-type :string) (parse-string token)
;;   :else (parse-unknown token))

;; –ò—Å–ø–æ–ª—å–∑—É–µ–º multimethods –¥–ª—è —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ–≥–æ –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞:

(defmulti parse-token-by-type 
  "–î–∏—Å–ø–µ—Ç—á–µ—Ä –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ —Ç–∏–ø—É"
  (fn [token state] (:type token)))

(defmethod parse-token-by-type :number
  [token state]
  (parser/success (parser/literal-node (:value token) :number) state))

(defmethod parse-token-by-type :identifier  
  [token state]
  (parser/success (parser/identifier-node (:value token)) state))

(defmethod parse-token-by-type :string
  [token state]
  (parser/success (parser/literal-node (:value token) :string) state))

(defmethod parse-token-by-type :default
  [token state]
  (parser/failure (str "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞: " (:type token)) state))

;; ============================================================================
;; –î–ò–°–ü–ï–¢–ß–ò–ù–ì –ü–û –ù–ï–°–ö–û–õ–¨–ö–ò–ú –ö–†–ò–¢–ï–†–ò–Ø–ú
;; ============================================================================

(defmulti parse-operator
  "–î–∏—Å–ø–µ—Ç—á–µ—Ä –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ —Ç–∏–ø—É –∏ –∑–Ω–∞—á–µ–Ω–∏—é"
  (fn [token state] [(:type token) (:value token)]))

(defmethod parse-operator [:math-operator :plus]
  [token state]
  (parser/success {:operator :addition :precedence 1} state))

(defmethod parse-operator [:math-operator :multiply]
  [token state]
  (parser/success {:operator :multiplication :precedence 2} state))

(defmethod parse-operator [:logical-operator :and]
  [token state]
  (parser/success {:operator :logical-and :precedence 0} state))

(defmethod parse-operator :default
  [token state]
  (parser/failure (str "–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä: " (:type token) " " (:value token)) state))

;; ============================================================================
;; –ò–ï–†–ê–†–•–ò–ß–ï–°–ö–ò–ô –î–ò–°–ü–ï–¢–ß–ò–ù–ì
;; ============================================================================

;; –°–æ–∑–¥–∞–µ–º –∏–µ—Ä–∞—Ä—Ö–∏—é —Ç–∏–ø–æ–≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–π
(derive ::arithmetic-expr ::expression)
(derive ::logical-expr ::expression)
(derive ::assignment-expr ::expression)

(derive ::binary-expr ::arithmetic-expr)
(derive ::unary-expr ::arithmetic-expr)

(defmulti optimize-expression
  "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏"
  :ast-type)

(defmethod optimize-expression ::binary-expr
  [expr]
  (println "–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –±–∏–Ω–∞—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ")
  ;; –õ–æ–≥–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–∏–Ω–∞—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
  expr)

(defmethod optimize-expression ::unary-expr
  [expr]
  (println "–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º —É–Ω–∞—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ")
  ;; –õ–æ–≥–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É–Ω–∞—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
  expr)

(defmethod optimize-expression ::expression
  [expr]
  (println "–ë–∞–∑–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏—è")
  ;; –ë–∞–∑–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
  expr)

;; ============================================================================
;; –î–ò–°–ü–ï–¢–ß–ò–ù–ì –ü–û –°–õ–û–ñ–ù–´–ú –£–°–õ–û–í–ò–Ø–ú
;; ============================================================================

(defmulti parse-c51-construct
  "–ü–∞—Ä—Å–∏–Ω–≥ C51-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π"
  (fn [tokens state]
    (let [first-token (first tokens)
          second-token (second tokens)]
      (cond
        (and (= (:type first-token) :c51-keyword)
             (= (:value first-token) :interrupt)) :interrupt-declaration
        (and (= (:type first-token) :c51-keyword)
             (= (:value first-token) :sfr)) :sfr-declaration
        (and (= (:type first-token) :c51-keyword)
             (= (:value first-token) :sbit)) :sbit-declaration
        (and (= (:type first-token) :type-keyword)
             (= (:type second-token) :identifier)) :function-or-variable
        :else :unknown))))

(defmethod parse-c51-construct :interrupt-declaration
  [tokens state]
  (println "–ü–∞—Ä—Å–∏–º interrupt –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—é")
  ;; –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ interrupt
  (parser/success {:type :interrupt} state))

(defmethod parse-c51-construct :sfr-declaration
  [tokens state]
  (println "–ü–∞—Ä—Å–∏–º SFR –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—é")
  ;; –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ SFR
  (parser/success {:type :sfr} state))

(defmethod parse-c51-construct :sbit-declaration
  [tokens state]
  (println "–ü–∞—Ä—Å–∏–º SBIT –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—é")
  ;; –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ SBIT
  (parser/success {:type :sbit} state))

(defmethod parse-c51-construct :function-or-variable
  [tokens state]
  (println "–ü–∞—Ä—Å–∏–º —Ñ—É–Ω–∫—Ü–∏—é –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é")
  ;; –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  (parser/success {:type :function-or-variable} state))

(defmethod parse-c51-construct :default
  [tokens state]
  (parser/failure "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è C51 –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è" state))

;; ============================================================================
;; –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ü–†–ï–ò–ú–£–©–ï–°–¢–í
;; ============================================================================

(defn demo-multimethods []
  (println "üéØ === –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø MULTIMETHODS === üéØ")
  (println)
  
  ;; –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–æ–∫–µ–Ω–æ–≤
  (println "üìã –ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ —Ç–∏–ø—É:")
  (let [number-token {:type :number :value 42}
        id-token {:type :identifier :value "x"}
        unknown-token {:type :unknown :value "???"}
        state {}]
    
    (println "  –ß–∏—Å–ª–æ:" (parse-token-by-type number-token state))
    (println "  –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä:" (parse-token-by-type id-token state))
    (println "  –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π:" (parse-token-by-type unknown-token state)))
  
  (println)
  (println "üîß –ü–∞—Ä—Å–∏–Ω–≥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤:")
  (let [plus-token {:type :math-operator :value :plus}
        mult-token {:type :math-operator :value :multiply}
        and-token {:type :logical-operator :value :and}
        state {}]
    
    (println "  –ü–ª—é—Å:" (parse-operator plus-token state))
    (println "  –£–º–Ω–æ–∂–µ–Ω–∏–µ:" (parse-operator mult-token state))
    (println "  –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –ò:" (parse-operator and-token state)))
  
  (println)
  (println "üèóÔ∏è –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:")
  (optimize-expression {:ast-type ::binary-expr :operator :plus})
  (optimize-expression {:ast-type ::unary-expr :operator :minus})
  (optimize-expression {:ast-type ::assignment-expr :operator :equal})
  
  (println)
  (println "üéâ Multimethods –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:")
  (println "  ‚Ä¢ –û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã)")
  (println "  ‚Ä¢ –ó–∞–∫—Ä—ã—Ç–æ—Å—Ç—å –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥)")
  (println "  ‚Ä¢ –ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –±–µ–∑ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è")
  (println "  ‚Ä¢ –î–∏—Å–ø–µ—Ç—á–∏–Ω–≥ –ø–æ –ª—é–±—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º")
  (println "  ‚Ä¢ –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è"))

;; ============================================================================
;; –°–†–ê–í–ù–ï–ù–ò–ï –° –¢–†–ê–î–ò–¶–ò–û–ù–ù–´–ú–ò –ü–û–î–•–û–î–ê–ú–ò
;; ============================================================================

(defn compare-approaches []
  (println "\nüìä === –°–†–ê–í–ù–ï–ù–ò–ï –ü–û–î–•–û–î–û–í === üìä")
  (println)
  
  (println "‚ùå –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π cond (–ø–ª–æ—Ö–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è):")
  (println "   (cond")
  (println "     (= type :number) (parse-number ...)")
  (println "     (= type :string) (parse-string ...)")
  (println "     (= type :identifier) (parse-identifier ...)")
  (println "     :else (error ...))")
  (println)
  
  (println "‚úÖ Multimethods (–æ—Ç–ª–∏—á–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è):")
  (println "   (defmulti parse-token :type)")
  (println "   (defmethod parse-token :number [token] ...)")
  (println "   (defmethod parse-token :string [token] ...)")
  (println "   (defmethod parse-token :identifier [token] ...)")
  (println)
  
  (println "üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ multimethods:")
  (println "   ‚Ä¢ –ù–æ–≤—ã–µ —Ç–∏–ø—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞")
  (println "   ‚Ä¢ –ö–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ")
  (println "   ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–π –∏ —Å–ª–æ–∂–Ω–æ–≥–æ –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞")
  (println "   ‚Ä¢ –õ—É—á—à–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å"))

;; –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
(def ^:export demo-multimethods demo-multimethods)
(def ^:export compare-approaches compare-approaches)
```

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ñ–∞–π–ª–µ –ø–∞—Ä—Å–µ—Ä–∞:

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –º–∞–∫—Ä–æ—Å `do-parse` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥, –≥–¥–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –ª–∏–Ω—Ç–µ—Ä–æ–º. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –º–∞–∫—Ä–æ—Å–æ–≤, –Ω–æ –¥–∞–≤–∞–π—Ç–µ –∏—Å–ø—Ä–∞–≤–∏–º —ç—Ç–æ, –¥–æ–±–∞–≤–∏–≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏:

```clojure
;; –ú–∞–∫—Ä–æ—Å –¥–ª—è —É–¥–æ–±–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤ (–ì–ò–ì–ò–ï–ù–ò–ß–ï–°–ö–ê–Ø –í–ï–†–°–ò–Ø)
(defmacro do-parse 
  "–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–π –º–∞–∫—Ä–æ—Å –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤ –≤ —Å—Ç–∏–ª–µ do-notation
   –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∑–∞—â–∏—Ç—É –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   –°–∏–º–≤–æ–ª _ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞"
  [& bindings]
  ;; –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º
  (when (even? (count bindings))
    (throw (ex-info "do-parse —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—á–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤: –ø–∞—Ä—ã binding-expression + —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ" 
                   {:bindings bindings
                    :count (count bindings)})))
  
  ;; –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –ø–∞—Ä—ã –∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
  (let [all-args (vec bindings)
        final-expr (last all-args)
        binding-pairs (partition 2 (butlast all-args))
        forbidden-names #{'state 'state# 'result 'result# 'parser-state 'parse-result}]
    
    ;; –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–∫—Ä–æ–º–µ _)
    (doseq [[binding _] binding-pairs]
      (when (and (symbol? binding) 
                 (not= binding '_)
                 (forbidden-names binding))
        (throw (ex-info "–ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ do-parse - –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –∑–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö" 
                       {:forbidden-binding binding
                        :forbidden-names forbidden-names}))))
    
    ;; –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–¥–∞
    (letfn [(build-parser-chain [pairs final-expr]
              (if (empty? pairs)
                ;; –§–∏–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ - –ø—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–Ω–æ —É–∂–µ –ø–∞—Ä—Å–µ—Ä–æ–º
                (if (and (list? final-expr) 
                         (or (= (first final-expr) 'return-parser)
                             (= (first final-expr) 'parser/return-parser)))
                  ;; –£–∂–µ –ø–∞—Ä—Å–µ—Ä - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                  final-expr
                  ;; –ù–µ –ø–∞—Ä—Å–µ—Ä - –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ return-parser
                  `(return-parser ~final-expr))
                (let [[binding expr] (first pairs)
                      remaining-pairs (rest pairs)
                      ;; –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
                      state-sym (gensym "parser-state")
                      result-sym (gensym "parse-result")]
                  (if (and (symbol? binding) (not= binding '_))
                    ;; –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (let [~binding (:value ~result-sym)
                                 ~'next-state (:state ~result-sym)]
                             (~(build-parser-chain remaining-pairs final-expr) ~'next-state))
                           ~result-sym)))
                    ;; –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (binding —ç—Ç–æ _ –∏–ª–∏ –Ω–µ —Å–∏–º–≤–æ–ª)
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (~(build-parser-chain remaining-pairs final-expr) (:state ~result-sym))
                           ~result-sym)))))))]
      
      (build-parser-chain binding-pairs final-expr))))
```

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –ª–∏–Ω—Ç–µ—Ä –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –º–∞–∫—Ä–æ—Å–æ–º. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –º–∞–∫—Ä–æ—Å–æ–≤ –≤ Clojure. –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –≤–µ—Ä—Å–∏—é –±–µ–∑ –º–∞–∫—Ä–æ—Å–æ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:

---

**User**

–ù–∞—Å–∫–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ multimethod –±—É–¥–µ—Ç –æ–ø—Ä–∞–≤–¥–∞–Ω–æ –≤–º–µ—Å—Ç–æ –º–∞–∫—Ä–æ—Å–∞ do-parse?
–ü–æ–∫–∞ —Ä–∞—Å—Å—É–∂–¥–∞–µ–º, –ø–æ–∫–∞ –≤ –∫–æ–¥ –Ω–µ –ª–µ–∑–µ–º.

---

**Cursor**

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —ç—Ç–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –¥–∏–∑–∞–π–Ω–∞. –≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–µ–∂–¥—É **–º–∞–∫—Ä–æ—Å–∞–º–∏** –∏ **multimethods** –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏.

## üéØ **–ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ multimethods vs do-parse –º–∞–∫—Ä–æ—Å**

### **–ú–∞–∫—Ä–æ—Å `do-parse` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è**

**‚úÖ –ü–æ—á–µ–º—É –º–∞–∫—Ä–æ—Å –ª—É—á—à–µ –∑–¥–µ—Å—å:**

1. **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è** - `do-parse` —Å–æ–∑–¥–∞–µ—Ç DSL –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤:
   ```clojure
   (do-parse
     token (expect-token :number)
     _ (expect-token :semicolon)
     (return-parser (literal-node (:value token) :number)))
   ```
   –≠—Ç–æ **—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä** - –º—ã –º–µ–Ω—è–µ–º **–∫–∞–∫ –ø–∏—à–µ—Ç—Å—è –∫–æ–¥**, –∞ –Ω–µ **–∫–∞–∫ –æ–Ω –¥–∏—Å–ø–µ—Ç—á–∏—Ç—Å—è**.

2. **–í—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏** - –º–∞–∫—Ä–æ—Å —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ compile-time, —Å–æ–∑–¥–∞–≤–∞—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –±–µ–∑ runtime overhead.

3. **–ú–æ–Ω–∞–¥–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è** - —ç—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è (–º–æ–Ω–∞–¥–∞ State), –∫–æ—Ç–æ—Ä–∞—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–∞–∫—Ä–æ—Å—ã.

4. **–õ–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å** - –≤—Å–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, —á—Ç–æ —É–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å.

### **Multimethods - –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏**

**‚ùå –ü–æ—á–µ–º—É multimethods –∑–¥–µ—Å—å –∏–∑–±—ã—Ç–æ—á–Ω—ã:**

1. **–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –Ω–µ –Ω—É–∂–µ–Ω** - —É –Ω–∞—Å –Ω–µ—Ç —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö —Ä–∞–∑–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –í—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É `state -> result`.

2. **Runtime overhead** - –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —á—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –º–∞–∫—Ä–æ—Å–æ–≤.

3. **–£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –±–µ–∑ –≤—ã–≥–æ–¥—ã** - –º—ã –±—ã –∑–∞–º–µ–Ω–∏–ª–∏ –ø—Ä–æ—Å—Ç—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞.

## üîß **–ì–¥–µ multimethods –ë–´–õ–ò –ë–´ –æ–ø—Ä–∞–≤–¥–∞–Ω—ã –≤ –ø–∞—Ä—Å–µ—Ä–µ:**

### **1. –î–∏—Å–ø–µ—Ç—á–∏–Ω–≥ –ø–æ —Ç–∏–ø–∞–º —Ç–æ–∫–µ–Ω–æ–≤:**
```clojure
(defmulti parse-literal :type)
(defmethod parse-literal :number [token] ...)
(defmethod parse-literal :string [token] ...)
(defmethod parse-literal :char [token] ...)
```

### **2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º AST —É–∑–ª–æ–≤:**
```clojure
(defmulti optimize-node :ast-type)
(defmethod optimize-node :binary-expression [node] ...)
(defmethod optimize-node :function-call [node] ...)
```

### **3. –ö–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:**
```clojure
(defmulti generate-code :target-arch)
(defmethod generate-code :8051 [ast] ...)
(defmethod generate-code :avr [ast] ...)
```

## üß† **–§–∏–ª–æ—Å–æ—Ñ–∏—è –≤—ã–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**

### **–ú–∞–∫—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è:**
- **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π** (DSL)
- **–ö–æ–º–ø–æ–∑–∏—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π** (–º–æ–Ω–∞–¥—ã, –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã)
- **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è boilerplate –∫–æ–¥–∞**
- **Compile-time —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π**

### **Multimethods –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è:**
- **–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º** (–Ω–µ —Ç–æ–ª—å–∫–æ —Ç–∏–ø–∞–º)
- **–û—Ç–∫—Ä—ã—Ç—ã—Ö –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º**
- **–°–ª–æ–∂–Ω–æ–≥–æ –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞** (–ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º)
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π**

## üìä **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

```clojure
;; –ú–∞–∫—Ä–æ—Å do-parse (compile-time)
;; –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤:
(fn [state]
  (let [result1 (parser1 state)]
    (if (:success? result1)
      (let [result2 (parser2 (:state result1))]
        ...))))

;; Multimethod (runtime)
;; –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Ç—Ä–µ–±—É–µ—Ç:
;; 1. –í—ã—á–∏—Å–ª–µ–Ω–∏—è dispatch —Ñ—É–Ω–∫—Ü–∏–∏
;; 2. –ü–æ–∏—Å–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–µ—Ç–æ–¥–æ–≤
;; 3. –í—ã–∑–æ–≤–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
```

## üéØ **–í—ã–≤–æ–¥:**

**`do-parse` –º–∞–∫—Ä–æ—Å - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. **–†–µ—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É** - —É—Å—Ç—Ä–∞–Ω—è–µ—Ç callback hell —á–µ—Ä–µ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é
2. **–û–ø—Ç–∏–º–∞–ª–µ–Ω –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - zero runtime overhead
3. **–ß–∏—Ç–∞–µ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º** - –ª–∏–Ω–µ–π–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω** - —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–æ–Ω–∞–¥—É State

**Multimethods —Å—Ç–æ–∏–ª–æ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞:
- –î–∏—Å–ø–µ—Ç—á–∏–Ω–≥ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ —Ç–∏–ø–∞–º —Ç–æ–∫–µ–Ω–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è AST –ø–æ —Ç–∏–ø–∞–º —É–∑–ª–æ–≤  
- –ö–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞–∫—Ä–æ—Å—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞, multimethods - –¥–ª—è –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º.

```clojure
   (do-parse
     token (expect-token :number)
     _ (expect-token :semicolon)
     (return-parser (literal-node (:value token) :number)))
```

```clojure
(defmulti parse-literal :type)
(defmethod parse-literal :number [token] ...)
(defmethod parse-literal :string [token] ...)
(defmethod parse-literal :char [token] ...)
```

```clojure
(defmulti optimize-node :ast-type)
(defmethod optimize-node :binary-expression [node] ...)
(defmethod optimize-node :function-call [node] ...)
```

```clojure
(defmulti generate-code :target-arch)
(defmethod generate-code :8051 [ast] ...)
(defmethod generate-code :avr [ast] ...)
```

```clojure
;; –ú–∞–∫—Ä–æ—Å do-parse (compile-time)
;; –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤:
(fn [state]
  (let [result1 (parser1 state)]
    (if (:success? result1)
      (let [result2 (parser2 (:state result1))]
        ...))))

;; Multimethod (runtime)
;; –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Ç—Ä–µ–±—É–µ—Ç:
;; 1. –í—ã—á–∏—Å–ª–µ–Ω–∏—è dispatch —Ñ—É–Ω–∫—Ü–∏–∏
;; 2. –ü–æ–∏—Å–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–µ—Ç–æ–¥–æ–≤
;; 3. –í—ã–∑–æ–≤–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
```

---

**User**

ok –≤—ã–Ω–µ—Å–∏ —ç—Ç–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª ./docs/multimethod_vs_macros.md 

---

**Cursor**

```markdown
# Multimethods vs –ú–∞–∫—Ä–æ—Å—ã –≤ –ø–∞—Ä—Å–µ—Ä–µ C51

## üéØ –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞: `do-parse` –º–∞–∫—Ä–æ—Å vs multimethods

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä –º–µ–∂–¥—É **–º–∞–∫—Ä–æ—Å–∞–º–∏** –∏ **multimethods** –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤ –≤ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–µ C51.

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏

–í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∞—Ä—Å–µ—Ä–∞ –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–æ–π **callback hell** - –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤:

```clojure
;; –ü–†–û–ë–õ–ï–ú–ê: Callback Hell
(fn [state]
  (let [result1 (parser1 state)]
    (if (:success? result1)
      (let [result2 (parser2 (:state result1))]
        (if (:success? result2)
          (let [result3 (parser3 (:state result2))]
            ;; –µ—â–µ –±–æ–ª—å—à–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏...
            ))))))
```

## üîß –†–µ—à–µ–Ω–∏–µ 1: –ú–∞–∫—Ä–æ—Å `do-parse`

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∞–∫—Ä–æ—Å–∞

**1. –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è**
```clojure
;; –≠–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å do-parse
(do-parse
  token (expect-token :number)
  _ (expect-token :semicolon)
  (return-parser (literal-node (:value token) :number)))
```

**2. –í—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (Compile-time)**
- –ú–∞–∫—Ä–æ—Å —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- –ù—É–ª–µ–≤–æ–π runtime overhead
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**3. –ú–æ–Ω–∞–¥–∏—á–µ—Å–∫–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è**
- –†–µ–∞–ª–∏–∑—É–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é (–º–æ–Ω–∞–¥–∞ State)
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–∞–∫—Ä–æ—Å—ã
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º

**4. –õ–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å**
- –í—Å–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –õ–∏–Ω–µ–π–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏

### üìä –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –∫–æ–¥

```clojure
;; do-parse —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥:
(fn [state]
  (let [result1 (parser1 state)]
    (if (:success? result1)
      (let [token (:value result1)
            result2 (parser2 (:state result1))]
        (if (:success? result2)
          (success (literal-node (:value token) :number) (:state result2))
          result2))
      result1)))
```

## üé≠ –†–µ—à–µ–Ω–∏–µ 2: Multimethods (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

### ‚ùå –ü–æ—á–µ–º—É multimethods –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞**
- –í—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å–∏–≥–Ω–∞—Ç—É—Ä—É: `state -> result`
- –ù–µ—Ç —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö —Ä–∞–∑–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

**2. Runtime overhead**
```clojure
;; –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ multimethod —Ç—Ä–µ–±—É–µ—Ç:
;; 1. –í—ã—á–∏—Å–ª–µ–Ω–∏—è dispatch —Ñ—É–Ω–∫—Ü–∏–∏
;; 2. –ü–æ–∏—Å–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–µ—Ç–æ–¥–æ–≤  
;; 3. –í—ã–∑–æ–≤–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
(defmulti compose-parsers :operation-type)
(defmethod compose-parsers :sequence [parsers state] ...)
```

**3. –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –±–µ–∑ –≤—ã–≥–æ–¥—ã**
- –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ—Å—Ç—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Å–ª–æ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞
- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –±–µ–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤

## üéØ –ì–¥–µ multimethods –ë–´–õ–ò –ë–´ –æ–ø—Ä–∞–≤–¥–∞–Ω—ã

### 1. –î–∏—Å–ø–µ—Ç—á–∏–Ω–≥ –ø–æ —Ç–∏–ø–∞–º —Ç–æ–∫–µ–Ω–æ–≤

```clojure
(defmulti parse-literal :type)

(defmethod parse-literal :number
  [token]
  (literal-node (:value token) :number))

(defmethod parse-literal :string  
  [token]
  (literal-node (:value token) :string))

(defmethod parse-literal :char
  [token]
  (literal-node (:value token) :char))

(defmethod parse-literal :default
  [token]
  (throw (ex-info "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –ª–∏—Ç–µ—Ä–∞–ª–∞" {:token token})))
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è AST –ø–æ —Ç–∏–ø–∞–º —É–∑–ª–æ–≤

```clojure
(defmulti optimize-node :ast-type)

(defmethod optimize-node :binary-expression
  [node]
  (optimize-binary-expression node))

(defmethod optimize-node :function-call
  [node]
  (optimize-function-call node))

(defmethod optimize-node :literal
  [node]
  node) ; –õ–∏—Ç–µ—Ä–∞–ª—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```

### 3. –ö–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä

```clojure
(defmulti generate-code :target-arch)

(defmethod generate-code :8051
  [ast]
  (generate-8051-code ast))

(defmethod generate-code :avr
  [ast]
  (generate-avr-code ast))

(defmethod generate-code :pic
  [ast]
  (generate-pic-code ast))
```

### 4. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥

```clojure
;; –°–æ–∑–¥–∞–µ–º –∏–µ—Ä–∞—Ä—Ö–∏—é —Ç–∏–ø–æ–≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–π
(derive ::arithmetic-expr ::expression)
(derive ::logical-expr ::expression)
(derive ::assignment-expr ::expression)

(derive ::binary-expr ::arithmetic-expr)
(derive ::unary-expr ::arithmetic-expr)

(defmulti validate-expression :ast-type)

(defmethod validate-expression ::binary-expr
  [expr]
  (validate-binary-expression expr))

(defmethod validate-expression ::expression
  [expr]
  (basic-expression-validation expr))
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ê—Å–ø–µ–∫—Ç | –ú–∞–∫—Ä–æ—Å `do-parse` | Multimethods |
|--------|-------------------|--------------|
| **–í—Ä–µ–º—è –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞** | Compile-time | Runtime |
| **Overhead** | –ù—É–ª–µ–≤–æ–π | –ü–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–µ—Ç–æ–¥–æ–≤ |
| **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** | –ü–æ–ª–Ω–∞—è (inline) | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è |
| **–ü–∞–º—è—Ç—å** | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è | –¢–∞–±–ª–∏—Ü—ã –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞ |

## üß† –§–∏–ª–æ—Å–æ—Ñ–∏—è –≤—ã–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### –ú–∞–∫—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è:
- ‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π** (—Å–æ–∑–¥–∞–Ω–∏–µ DSL)
- ‚úÖ **–ö–æ–º–ø–æ–∑–∏—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π** (–º–æ–Ω–∞–¥—ã, –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã)
- ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è boilerplate –∫–æ–¥–∞**
- ‚úÖ **Compile-time —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π**

### Multimethods –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è:
- ‚úÖ **–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º** (–Ω–µ —Ç–æ–ª—å–∫–æ —Ç–∏–ø–∞–º)
- ‚úÖ **–û—Ç–∫—Ä—ã—Ç—ã—Ö –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º**
- ‚úÖ **–°–ª–æ–∂–Ω–æ–≥–æ –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞** (–ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º)
- ‚úÖ **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π**

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### –ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **–ú–∞–∫—Ä–æ—Å—ã** –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **Multimethods** –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–µ–≥–æ —É–¥–∏–≤–ª–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–≤—ã—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–∏–≤—ã—á–Ω—ã—Ö –∑–∞–¥–∞—á
- –ú–∞–∫—Ä–æ—Å—ã –¥–ª—è DSL, multimethods –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞

### –ü—Ä–∏–Ω—Ü–∏–ø –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ compile-time —Ä–µ—à–µ–Ω–∏—è runtime —Ä–µ—à–µ–Ω–∏—è–º
- –ò–∑–±–µ–≥–∞–π—Ç–µ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

## üìù –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞–∫—Ä–æ—Å—ã –∫–æ–≥–¥–∞:
1. –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —è–∑—ã–∫–∞
2. –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
3. –í–∞–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
4. –õ–æ–≥–∏–∫–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ multimethods –∫–æ–≥–¥–∞:
1. –ù—É–∂–µ–Ω –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º
2. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
3. –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–ª–æ–∂–Ω—ã–π –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥
4. –ï—Å—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏

## üîç –ê–Ω–∞–ª–∏–∑ –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è

### –ó–∞–¥–∞—á–∞: –ö–æ–º–ø–æ–∑–∏—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–æ–≤
- **–¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã**: –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
- **–•–∞—Ä–∞–∫—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö**: –û–¥–Ω–æ—Ä–æ–¥–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π
- **–í—Ä–µ–º—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π**: Compile-time

### –í—ã–≤–æ–¥: –ú–∞–∫—Ä–æ—Å `do-parse` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
1. **–†–µ—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É** - —É—Å—Ç—Ä–∞–Ω—è–µ—Ç callback hell —á–µ—Ä–µ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é
2. **–û–ø—Ç–∏–º–∞–ª–µ–Ω –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - zero runtime overhead
3. **–ß–∏—Ç–∞–µ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º** - –ª–∏–Ω–µ–π–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π  
4. **–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω** - —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–æ–Ω–∞–¥—É State
5. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏

## üöÄ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**
> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞–∫—Ä–æ—Å—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞, multimethods - –¥–ª—è –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º.

–í –Ω–∞—à–µ–º –ø–∞—Ä—Å–µ—Ä–µ:
- **`do-parse` –º–∞–∫—Ä–æ—Å** —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤
- **Multimethods** –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç—è—Ö —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –¥–∏—Å–ø–µ—Ç—á–∏–Ω–≥–∞ –ø–æ —Ç–∏–ø–∞–º —Ç–æ–∫–µ–Ω–æ–≤, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ AST –∏ –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ - –æ—Å–Ω–æ–≤–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∞—Ä—Å–µ—Ä–∞ C51 –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞*
*–ê–≤—Ç–æ—Ä: Senior Clojure Developer*
*–î–∞—Ç–∞: 2024*
```

–û—Ç–ª–∏—á–Ω–æ! –Ø —Å–æ–∑–¥–∞–ª –ø–æ–¥—Ä–æ–±–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç `docs/multimethod_vs_macros.md` —Å –∞–Ω–∞–ª–∏–∑–æ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É multimethods –∏ –º–∞–∫—Ä–æ—Å–∞–º–∏.

## üìã **–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç:**

### üéØ **–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**
1. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏** - –ø—Ä–æ–±–ª–µ–º–∞ callback hell
2. **–ê–Ω–∞–ª–∏–∑ –º–∞–∫—Ä–æ—Å–∞ `do-parse`** - –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
3. **–ê–Ω–∞–ª–∏–∑ multimethods** - –ø–æ—á–µ–º—É –æ–Ω–∏ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
4. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏ –¥–ª—è multimethods** - –≥–¥–µ –æ–Ω–∏ –±—ã–ª–∏ –±—ã –æ–ø—Ä–∞–≤–¥–∞–Ω—ã
5. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - —Ç–∞–±–ª–∏—Ü–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
6. **–§–∏–ª–æ—Å–æ—Ñ–∏—è –≤—ã–±–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤** - –ø—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
7. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** - –∫–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### üß† **–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:**

**‚úÖ –ú–∞–∫—Ä–æ—Å `do-parse` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ—Ç–æ–º—É —á—Ç–æ:**
- –†–µ—à–∞–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É (callback hell)
- Zero runtime overhead (compile-time)
- –†–µ–∞–ª–∏–∑—É–µ—Ç –º–æ–Ω–∞–¥—É State –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

**‚ùå Multimethods –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Ç–æ–º—É —á—Ç–æ:**
- –ù–µ—Ç –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ (–≤—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ)
- Runtime overhead –±–µ–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤
- –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –±–µ–∑ –≤—ã–≥–æ–¥—ã

**üéØ –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:**
> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞–∫—Ä–æ—Å—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞, multimethods - –¥–ª—è –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º.

–î–æ–∫—É–º–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å —Å–ª—É–∂–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –±—É–¥—É—â–µ–º –∏ –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É –º—ã –≤—ã–±—Ä–∞–ª–∏ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã callback hell –≤ –ø–∞—Ä—Å–µ—Ä–µ.

---

**User**

–æ–±—ä—Å–Ω–∏ –ø–æ—á–µ–º—É —Å—Ç—Ä–æ–∫–∏ 103-104 –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã?
–ë—ã–ª–æ:
```
                                 next-state# (:state ~result-sym)]
                             (~(build-parser-chain remaining-pairs final-expr) next-state#))
```
–°—Ç–∞–ª–æ:
```
                                 ~'next-state (:state ~result-sym)]
                             (~(build-parser-chain remaining-pairs final-expr) ~'next-state))
```

---

**Cursor**

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å **–≥–∏–≥–∏–µ–Ω–∏—á–Ω–æ—Å—Ç—å—é –º–∞–∫—Ä–æ—Å–æ–≤** –∏ **–∑–∞—Ö–≤–∞—Ç–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** –≤ Clojure. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –¥–µ—Ç–∞–ª—å–Ω–æ:

## üîç **–ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

### **–ë—ã–ª–æ (–ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ):**
```clojure
next-state# (:state ~result-sym)]
(~(build-parser-chain remaining-pairs final-expr) next-state#))
```

### **–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```clojure
~'next-state (:state ~result-sym)]
(~(build-parser-chain remaining-pairs final-expr) ~'next-state))
```

## üß† **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π**

### **1. `next-state#` vs `~'next-state`**

**`next-state#`** - —ç—Ç–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π gensym**:
- Clojure –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ç–∏–ø–∞ `next-state__1234__auto__`
- –ö–∞–∂–¥—ã–π —Ä–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è **–Ω–æ–≤—ã–π** —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
- –ü—Ä–æ–±–ª–µ–º–∞: —Å–∏–º–≤–æ–ª –≤ `let` –∏ —Å–∏–º–≤–æ–ª –≤ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å **—Ä–∞–∑–Ω—ã–º–∏**!

**`~'next-state`** - —ç—Ç–æ **–Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª**:
- `~'` –æ–∑–Ω–∞—á–∞–µ—Ç "unquote-splice –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞"
- –°–æ–∑–¥–∞–µ—Ç—Å—è **–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ** —Å–∏–º–≤–æ–ª `next-state` –≤ –æ–±–æ–∏—Ö –º–µ—Å—Ç–∞—Ö
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ `let` –∏ –≤ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ **–æ–¥–∏–Ω–∞–∫–æ–≤–∞—è**

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å `#`**

### **–ü—Ä–æ–±–ª–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ gensym:**
```clojure
;; –ú–∞–∫—Ä–æ—Å –º–æ–∂–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
(let [result123 (parser state)]
  (if (:success? result123)
    (let [token (:value result123)
          next-state__1234__auto__ (:state result123)]  ; –û–¥–∏–Ω —Å–∏–º–≤–æ–ª
      (next-parser next-state__5678__auto__))           ; –î–†–£–ì–û–ô —Å–∏–º–≤–æ–ª!
    result123))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `next-state` –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤—ã–∑–æ–≤–∞!

### **–†–µ—à–µ–Ω–∏–µ —Å `~'`:**
```clojure
;; –° ~'next-state –ø–æ–ª—É—á–∞–µ–º:
(let [result123 (parser state)]
  (if (:success? result123)
    (let [token (:value result123)
          next-state (:state result123)]    ; –°–∏–º–≤–æ–ª next-state
      (next-parser next-state))             ; –¢–û–¢ –ñ–ï —Å–∏–º–≤–æ–ª next-state
    result123))
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–≤—è–∑–∞–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞!

## üìö **–¢–µ–æ—Ä–∏—è: –ì–∏–≥–∏–µ–Ω–∏—á–Ω–æ—Å—Ç—å –º–∞–∫—Ä–æ—Å–æ–≤**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π gensym (`#`)**
- **–¶–µ–ª—å:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –∑–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `symbol#` —Å–æ–∑–¥–∞–µ—Ç **–Ω–æ–≤—ã–π** —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è

### **–ù–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª (`~'`)**
- **–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å —Å–∏–º–≤–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–º** –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–æ–º
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –î–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

## üéØ **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä**

### **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã:**
```clojure
(defmacro broken-let [var value & body]
  `(let [~(symbol (str (name var) "#")) ~value]  ; –°–æ–∑–¥–∞–µ–º symbol#
     ~@(map (fn [form] 
              (if (= form var)
                (symbol (str (name var) "#"))    ; –°–æ–∑–¥–∞–µ–º –î–†–£–ì–û–ô symbol#
                form)) 
            body)))

;; –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
(broken-let x 42 (println x))  ; –û–®–ò–ë–ö–ê: x –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!
```

### **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
```clojure
(defmacro working-let [var value & body]
  (let [var-sym (gensym (name var))]  ; –°–æ–∑–¥–∞–µ–º –û–î–ò–ù —Å–∏–º–≤–æ–ª
    `(let [~var-sym ~value]
       ~@(map (fn [form]
                (if (= form var)
                  var-sym                ; –ò—Å–ø–æ–ª—å–∑—É–µ–º –¢–û–¢ –ñ–ï —Å–∏–º–≤–æ–ª
                  form))
              body))))

;; –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
(working-let x 42 (println x))  ; –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!
```

## üîç **–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –Ω–∞—à–µ–≥–æ –º–∞–∫—Ä–æ—Å–∞**

### **–ü–æ—á–µ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±—ã–ª–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:**
1. **–°–≤—è–∑—ã–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:** `next-state` —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ `let`
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:** `next-state` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤
3. **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –≠—Ç–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ** –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
4. **–†–µ—à–µ–Ω–∏–µ:** `~'next-state` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–∞

### **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
```clojure
;; –í–∞—Ä–∏–∞–Ω—Ç 1: –Ø–≤–Ω—ã–π gensym (–±–æ–ª–µ–µ verbose)
(let [next-state-sym (gensym "next-state")]
  `(let [~next-state-sym (:state ~result-sym)]
     (~(build-parser-chain remaining-pairs final-expr) ~next-state-sym)))

;; –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞—à –≤—ã–±–æ—Ä (–±–æ–ª–µ–µ –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π)
`(let [~'next-state (:state ~result-sym)]
   (~(build-parser-chain remaining-pairs final-expr) ~'next-state))
```

## üéØ **–í—ã–≤–æ–¥**

–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å `next-state#` –Ω–∞ `~'next-state` –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç **—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –æ—à–∏–±–∫—É** –≤ –º–∞–∫—Ä–æ—Å–µ:

- **–ü—Ä–æ–±–ª–µ–º–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π gensym —Å–æ–∑–¥–∞–≤–∞–ª —Ä–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- **–†–µ—à–µ–Ω–∏–µ:** –ù–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω—Å—Ç–≤–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∞–∫—Ä–æ—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–æ–¥ –±–µ–∑ –æ—à–∏–±–æ–∫ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è

–≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, –∫–∞–∫ **–¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞–∫—Ä–æ—Å–æ–≤** –≤–ª–∏—è—é—Ç –Ω–∞ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–¥–∞**. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É `#`, `~'` –∏ —è–≤–Ω—ã–º–∏ gensym'–∞–º–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –Ω–∞–¥–µ–∂–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–æ–≤ –≤ Clojure.

```clojure
next-state# (:state ~result-sym)]
(~(build-parser-chain remaining-pairs final-expr) next-state#))
```

```clojure
~'next-state (:state ~result-sym)]
(~(build-parser-chain remaining-pairs final-expr) ~'next-state))
```

```clojure
;; –ú–∞–∫—Ä–æ—Å –º–æ–∂–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
(let [result123 (parser state)]
  (if (:success? result123)
    (let [token (:value result123)
          next-state__1234__auto__ (:state result123)]  ; –û–¥–∏–Ω —Å–∏–º–≤–æ–ª
      (next-parser next-state__5678__auto__))           ; –î–†–£–ì–û–ô —Å–∏–º–≤–æ–ª!
    result123))
```

```clojure
;; –° ~'next-state –ø–æ–ª—É—á–∞–µ–º:
(let [result123 (parser state)]
  (if (:success? result123)
    (let [token (:value result123)
          next-state (:state result123)]    ; –°–∏–º–≤–æ–ª next-state
      (next-parser next-state))             ; –¢–û–¢ –ñ–ï —Å–∏–º–≤–æ–ª next-state
    result123))
```

```clojure
(defmacro broken-let [var value & body]
  `(let [~(symbol (str (name var) "#")) ~value]  ; –°–æ–∑–¥–∞–µ–º symbol#
     ~@(map (fn [form] 
              (if (= form var)
                (symbol (str (name var) "#"))    ; –°–æ–∑–¥–∞–µ–º –î–†–£–ì–û–ô symbol#
                form)) 
            body)))

;; –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
(broken-let x 42 (println x))  ; –û–®–ò–ë–ö–ê: x –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω!
```

```clojure
(defmacro working-let [var value & body]
  (let [var-sym (gensym (name var))]  ; –°–æ–∑–¥–∞–µ–º –û–î–ò–ù —Å–∏–º–≤–æ–ª
    `(let [~var-sym ~value]
       ~@(map (fn [form]
                (if (= form var)
                  var-sym                ; –ò—Å–ø–æ–ª—å–∑—É–µ–º –¢–û–¢ –ñ–ï —Å–∏–º–≤–æ–ª
                  form))
              body))))

;; –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
(working-let x 42 (println x))  ; –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!
```

```clojure
;; –í–∞—Ä–∏–∞–Ω—Ç 1: –Ø–≤–Ω—ã–π gensym (–±–æ–ª–µ–µ verbose)
(let [next-state-sym (gensym "next-state")]
  `(let [~next-state-sym (:state ~result-sym)]
     (~(build-parser-chain remaining-pairs final-expr) ~next-state-sym)))

;; –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞—à –≤—ã–±–æ—Ä (–±–æ–ª–µ–µ –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π)
`(let [~'next-state (:state ~result-sym)]
   (~(build-parser-chain remaining-pairs final-expr) ~'next-state))
```

---

**User**

–∏ —É –Ω–∞—Å –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç–æ–π –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö ?

---

**Cursor**

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –≠—Ç–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è** –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥–∏–∑–∞–π–Ω–µ –º–∞–∫—Ä–æ—Å–æ–≤. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∏—Å–∫–∏ –∏ –∑–∞—â–∏—Ç—É.

## üö® **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å `~'next-state`**

### **–†–∏—Å–∫ –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:**
```clojure
;; –û–ü–ê–°–ù–´–ô —Å—Ü–µ–Ω–∞—Ä–∏–π:
(let [next-state "—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é!"]
  (do-parse
    token (expect-token :number)
    _ (expect-token :semicolon)
    (return-parser (literal-node (:value token) :number))))

;; –ú–∞–∫—Ä–æ—Å —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:
(let [next-state "—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é!"]
  (fn [state]
    (let [result (expect-token :number state)]
      (if (:success? result)
        (let [token (:value result)
              next-state (:state result)]  ; –ö–û–ù–§–õ–ò–ö–¢! –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
          ...)))))
```

## üõ°Ô∏è **–ù–æ —É –Ω–∞—Å –µ—Å—Ç—å –∑–∞—â–∏—Ç–∞!**

### **1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞–∫—Ä–æ—Å–∞**
–ù–∞—à –º–∞–∫—Ä–æ—Å `do-parse` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π –ø–∞—Ä—Å–µ—Ä–∞**, –≥–¥–µ:
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `next-state` **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–¥–µ
- –≠—Ç–æ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è** –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –º–∞–∫—Ä–æ—Å–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å **–∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ (`token`, `expr`, etc.)

### **2. –û–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏**
```clojure
;; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç:
(do-parse
  token (expect-token :number)      ; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
  expr (parse-expression)           ; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è  
  (return-parser (combine token expr)))

;; –ú–∞–∫—Ä–æ—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:
(fn [state]
  (let [result1 (expect-token :number state)]
    (if (:success? result1)
      (let [token (:value result1)           ; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è
            next-state (:state result1)]     ; –í–ù–£–¢–†–ï–ù–ù–Ø–Ø –º–∞–∫—Ä–æ—Å–∞
        (let [result2 (parse-expression next-state)]
          (if (:success? result2)
            (let [expr (:value result2)      ; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è
                  next-state (:state result2)]  ; –í–ù–£–¢–†–ï–ù–ù–Ø–Ø –º–∞–∫—Ä–æ—Å–∞
              ...)))))))
```

## üîß **–ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**

–î–∞–≤–∞–π—Ç–µ —É–ª—É—á—à–∏–º –º–∞–∫—Ä–æ—Å –¥–ª—è **–∞–±—Å–æ–ª—é—Ç–Ω–æ–π** –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã:

```clojure
(defmacro do-parse 
  [& bindings]
  ;; ... –≤–∞–ª–∏–¥–∞—Ü–∏—è ...
  (let [state-sym (gensym "parser-state")
        result-sym (gensym "parse-result")
        next-state-sym (gensym "next-state")]  ; –Ø–≤–Ω—ã–π gensym –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    
    (letfn [(build-parser-chain [pairs final-expr]
              (if (empty? pairs)
                final-expr
                (let [[binding expr] (first pairs)
                      remaining-pairs (rest pairs)]
                  (if (and (symbol? binding) (not= binding '_))
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (let [~binding (:value ~result-sym)
                                 ~next-state-sym (:state ~result-sym)]  ; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π gensym
                             (~(build-parser-chain remaining-pairs final-expr) ~next-state-sym))
                           ~result-sym)))
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (~(build-parser-chain remaining-pairs final-expr) (:state ~result-sym))
                           ~result-sym)))))))]
      
      (build-parser-chain binding-pairs final-expr))))
```

## üéØ **–ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–µ—à–µ–Ω–∏–π**

### **–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ `~'next-state`:**
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç** –≤ –Ω–∞—à–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ** –∏ —á–∏—Ç–∞–µ–º–æ–µ
- ‚ö†Ô∏è **–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫** –∑–∞—Ö–≤–∞—Ç–∞ (–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω—ã–π)
- ‚ö†Ô∏è **–ù–µ –∏–¥–µ–∞–ª—å–Ω–æ** —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≥–∏–≥–∏–µ–Ω–∏—á–Ω–æ—Å—Ç–∏

### **–£–ª—É—á—à–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å `gensym`:**
- ‚úÖ **–ê–±—Å–æ–ª—é—Ç–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ** –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞
- ‚úÖ **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç–æ–µ**
- ‚úÖ **–°–ª–µ–¥—É–µ—Ç best practices**
- ‚ùå **–ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–µ** (–Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

## üìä **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤**

### **–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å `~'next-state`:**
```clojure
;; –ß—Ç–æ–±—ã –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞, –Ω—É–∂–Ω–æ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `next-state`
2. –í —Ç–æ–º –∂–µ –ª–µ–∫—Å–∏—á–µ—Å–∫–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è do-parse
3. –ò —ç—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–ª–∂–Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ª–æ–≥–∏–∫–æ–π

;; –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞:
(let [next-state "–∫–æ–Ω—Ñ–ª–∏–∫—Ç"]
  (some-function-that-uses-do-parse))  ; –û—á–µ–Ω—å –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ!
```

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** **–ö—Ä–∞–π–Ω–µ –Ω–∏–∑–∫–∞—è** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ –ø–∞—Ä—Å–µ—Ä–∞.

## üõ†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**

### **–î–ª—è production –∫–æ–¥–∞:**
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **—è–≤–Ω—ã–π gensym** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```clojure
(defmacro do-parse-safe [& bindings]
  ;; –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –æ–¥–∏–Ω —Ä–∞–∑
  (let [state-sym (gensym "state")
        result-sym (gensym "result") 
        next-state-sym (gensym "next-state")]
    ;; –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –≤–æ –≤—Å–µ–º –º–∞–∫—Ä–æ—Å–µ
    ...))
```

### **–î–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞:**
`~'next-state` **–ø—Ä–∏–µ–º–ª–µ–º–æ**, –Ω–æ —Å—Ç–æ–∏—Ç:
1. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ** –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
3. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å** —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ gensym

## üéØ **–ò—Ç–æ–≥–æ–≤—ã–π –≤—ã–≤–æ–¥**

**–¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ 99.9% —Å–ª—É—á–∞–µ–≤
- ‚ö†Ô∏è –ò–º–µ–µ—Ç —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫ –∑–∞—Ö–≤–∞—Ç–∞
- üîß –¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

**–ò–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–∏—Ç—å `~'next-state` –Ω–∞ `(gensym "next-state")`
- –û–±–µ—Å–ø–µ—á–∏—Ç—å **–∞–±—Å–æ–ª—é—Ç–Ω—É—é** –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫—É—é —á–∏—Å—Ç–æ—Ç—É
- –°–ª–µ–¥–æ–≤–∞—Ç—å **best practices** Clojure –º–∞–∫—Ä–æ—Å–æ–≤

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –º–∞–∫—Ä–æ—Å–æ–≤:**
> –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ gensym –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–∞, –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—å –º–∞–ª–µ–π—à–∏–π —à–∞–Ω—Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–º–µ–Ω.

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –∏—Å–ø—Ä–∞–≤–∏–ª –º–∞–∫—Ä–æ—Å –Ω–∞ **–∞–±—Å–æ–ª—é—Ç–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω—É—é** –≤–µ—Ä—Å–∏—é —Å gensym?

```clojure
;; –û–ü–ê–°–ù–´–ô —Å—Ü–µ–Ω–∞—Ä–∏–π:
(let [next-state "—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é!"]
  (do-parse
    token (expect-token :number)
    _ (expect-token :semicolon)
    (return-parser (literal-node (:value token) :number))))

;; –ú–∞–∫—Ä–æ—Å —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:
(let [next-state "—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é!"]
  (fn [state]
    (let [result (expect-token :number state)]
      (if (:success? result)
        (let [token (:value result)
              next-state (:state result)]  ; –ö–û–ù–§–õ–ò–ö–¢! –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
          ...)))))
```

```clojure
;; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç:
(do-parse
  token (expect-token :number)      ; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
  expr (parse-expression)           ; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è  
  (return-parser (combine token expr)))

;; –ú–∞–∫—Ä–æ—Å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:
(fn [state]
  (let [result1 (expect-token :number state)]
    (if (:success? result1)
      (let [token (:value result1)           ; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è
            next-state (:state result1)]     ; –í–ù–£–¢–†–ï–ù–ù–Ø–Ø –º–∞–∫—Ä–æ—Å–∞
        (let [result2 (parse-expression next-state)]
          (if (:success? result2)
            (let [expr (:value result2)      ; –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è
                  next-state (:state result2)]  ; –í–ù–£–¢–†–ï–ù–ù–Ø–Ø –º–∞–∫—Ä–æ—Å–∞
              ...)))))))
```

```clojure
(defmacro do-parse 
  [& bindings]
  ;; ... –≤–∞–ª–∏–¥–∞—Ü–∏—è ...
  (let [state-sym (gensym "parser-state")
        result-sym (gensym "parse-result")
        next-state-sym (gensym "next-state")]  ; –Ø–≤–Ω—ã–π gensym –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    
    (letfn [(build-parser-chain [pairs final-expr]
              (if (empty? pairs)
                final-expr
                (let [[binding expr] (first pairs)
                      remaining-pairs (rest pairs)]
                  (if (and (symbol? binding) (not= binding '_))
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (let [~binding (:value ~result-sym)
                                 ~next-state-sym (:state ~result-sym)]  ; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π gensym
                             (~(build-parser-chain remaining-pairs final-expr) ~next-state-sym))
                           ~result-sym)))
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (~(build-parser-chain remaining-pairs final-expr) (:state ~result-sym))
                           ~result-sym)))))))]
      
      (build-parser-chain binding-pairs final-expr))))
```

```clojure
;; –ß—Ç–æ–±—ã –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞, –Ω—É–∂–Ω–æ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `next-state`
2. –í —Ç–æ–º –∂–µ –ª–µ–∫—Å–∏—á–µ—Å–∫–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è do-parse
3. –ò —ç—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–æ–ª–∂–Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ª–æ–≥–∏–∫–æ–π

;; –†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞:
(let [next-state "–∫–æ–Ω—Ñ–ª–∏–∫—Ç"]
  (some-function-that-uses-do-parse))  ; –û—á–µ–Ω—å –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ!
```

```clojure
(defmacro do-parse-safe [& bindings]
  ;; –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –æ–¥–∏–Ω —Ä–∞–∑
  (let [state-sym (gensym "state")
        result-sym (gensym "result") 
        next-state-sym (gensym "next-state")]
    ;; –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –≤–æ –≤—Å–µ–º –º–∞–∫—Ä–æ—Å–µ
    ...))
```

---

**User**

–¥–∞, –¥–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º.
–°–¥–µ–ª–∞–π –æ–± —ç—Ç–æ–º –∑–∞–ø–∏—Å—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ ./docs/next_state-gensym.md
–°—Ä–∞–≤–Ω–∏ –º–µ—Ç–æ–¥—ã –∏ —Å–≤–µ–¥–∏ –∞–Ω–∞–ª–∏–∑—ã –∏ —Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É.

---

**Cursor**

```markdown
# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã `next-state` –∏ –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã –º–∞–∫—Ä–æ—Å–æ–≤

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –º–∞–∫—Ä–æ—Å–µ `do-parse`

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –º–∞–∫—Ä–æ—Å–µ `do-parse` –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã.

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º—ã

–í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –º–∞–∫—Ä–æ—Å–∞ `do-parse` –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –≤—ã–±–æ—Ä–æ–º –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

### –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
```clojure
;; –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω—ã–π –∫–æ–¥ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º gensym:
`(let [~binding (:value ~result-sym)
       next-state# (:state ~result-sym)]           ; –û–¥–∏–Ω —Å–∏–º–≤–æ–ª
   (~(build-parser-chain ...) next-state#))       ; –î–†–£–ì–û–ô —Å–∏–º–≤–æ–ª!
```

### –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
```clojure
;; –¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–∏–º–≤–æ–ª–æ–º:
`(let [~binding (:value ~result-sym)
       ~'next-state (:state ~result-sym)]         ; –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è
   (~(build-parser-chain ...) ~'next-state))     ; –¢–æ –∂–µ –∏–º—è
```

## üîç –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–¥–æ–≤

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π gensym (`symbol#`)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
```clojure
;; –ö–∞–∂–¥–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ symbol# —Å–æ–∑–¥–∞–µ—Ç –ù–û–í–´–ô —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
`(let [var# 42]      ; var__1234__auto__
   (println var#))   ; var__5678__auto__ - –î–†–£–ì–û–ô —Å–∏–º–≤–æ–ª!
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ö–∞–∂–¥–æ–µ `#` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —á–∞—Å—Ç—è–º–∏ –º–∞–∫—Ä–æ—Å–∞
- –ü–æ–¥—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### 2. –ù–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª (`~'symbol`)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
```clojure
;; –°–æ–∑–¥–∞–µ—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–∏–º–≤–æ–ª –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
`(let [~'var 42]     ; var
   (println ~'var))  ; var - —Ç–æ—Ç –∂–µ —Å–∏–º–≤–æ–ª
```

**–†–∏—Å–∫–∏:**
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∑–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã –º–∞–∫—Ä–æ—Å–∞
- –ú–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### 3. –Ø–≤–Ω—ã–π gensym (`(gensym "prefix")`)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
```clojure
;; –°–æ–∑–¥–∞–µ–º —Å–∏–º–≤–æ–ª –æ–¥–∏–Ω —Ä–∞–∑, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ–∑–¥–µ
(let [var-sym (gensym "var")]
  `(let [~var-sym 42]     ; var1234
     (println ~var-sym))) ; var1234 - —Ç–æ—Ç –∂–µ —Å–∏–º–≤–æ–ª
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ–ª–Ω–∞—è –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç–æ–¥–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π gensym (`#`) | –ù–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (`~'`) | –Ø–≤–Ω—ã–π gensym |
|----------|----------------------------|---------------------------|--------------|
| **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞** | ‚ùå –ù–∞—Ä—É—à–µ–Ω–∞ (—Ä–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã) | ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∞ | ‚úÖ –ü–æ–ª–Ω–∞—è |
| **–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞** | ‚úÖ –ü–æ–ª–Ω–∞—è (–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç) | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚úÖ –ü–æ–ª–Ω–∞—è |
| **–°–≤—è–∑—ã–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚ö†Ô∏è –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | ‚ö†Ô∏è –†–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ | ‚úÖ –ê–±—Å–æ–ª—é—Ç–Ω–∞—è |
| **Best practices** | ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | ‚ùå –ù–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç |

## üö® –ê–Ω–∞–ª–∏–∑ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —Ä–∏—Å–∫–∞

### –†–∏—Å–∫–∏ –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ (`~'next-state`)

#### –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
```clojure
;; –ü—Ä—è–º–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω
(let [next-state "–≤–Ω–µ—à–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è"]
  (do-parse
    token (expect-token :number)
    (return-parser token)))  ; next-state –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞!
```

#### –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫
```clojure
;; –ö–æ—Å–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç —á–µ—Ä–µ–∑ –º–∞–∫—Ä–æ—Å—ã
(defmacro user-macro []
  `(let [~'next-state "–∫–æ–Ω—Ñ–ª–∏–∫—Ç"]
     (some-parser-function)))
```

#### –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫
```clojure
;; –û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
(defn parse-expression [state]
  (do-parse
    token (expect-token :number)
    (return-parser (literal-node (:value token) :number))))
```

### –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

| –°—Ü–µ–Ω–∞—Ä–∏–π | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å | –û–±—â–∏–π —Ä–∏—Å–∫ |
|----------|-------------|-------------|------------|
| **–ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `next-state`** | –ù–∏–∑–∫–∞—è (5%) | –í—ã—Å–æ–∫–∞—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π |
| **–ö–æ–Ω—Ñ–ª–∏–∫—Ç —á–µ—Ä–µ–∑ –º–∞–∫—Ä–æ—Å—ã** | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è (1%) | –í—ã—Å–æ–∫–∞—è | ‚ö†Ô∏è –ù–∏–∑–∫–∏–π |
| **–û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞** | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è (0.1%) | –ù–∏–∑–∫–∞—è | ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π |
| **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞** | –°—Ä–µ–¥–Ω—è—è (20%) | –°—Ä–µ–¥–Ω—è—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π |

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –Ø–≤–Ω—ã–π gensym

### –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–∫—Ä–æ—Å–∞

```clojure
(defmacro do-parse-safe
  "–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è do-parse —Å —è–≤–Ω—ã–º–∏ gensym"
  [& bindings]
  ;; –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  (when (even? (count bindings))
    (throw (ex-info "do-parse —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—á–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤" 
                   {:bindings bindings})))
  
  (let [all-args (vec bindings)
        final-expr (last all-args)
        binding-pairs (partition 2 (butlast all-args))
        ;; –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –û–î–ò–ù —Ä–∞–∑
        state-sym (gensym "parser-state")
        result-sym (gensym "parse-result")
        next-state-sym (gensym "next-state")]  ; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∏–º–≤–æ–ª
    
    (letfn [(build-parser-chain [pairs final-expr]
              (if (empty? pairs)
                (if (and (list? final-expr) 
                         (= (first final-expr) 'return-parser))
                  final-expr
                  `(return-parser ~final-expr))
                (let [[binding expr] (first pairs)
                      remaining-pairs (rest pairs)]
                  (if (and (symbol? binding) (not= binding '_))
                    ;; –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (let [~binding (:value ~result-sym)
                                 ~next-state-sym (:state ~result-sym)]  ; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π gensym
                             (~(build-parser-chain remaining-pairs final-expr) ~next-state-sym))
                           ~result-sym)))
                    ;; –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (~(build-parser-chain remaining-pairs final-expr) (:state ~result-sym))
                           ~result-sym)))))))]
      
      (build-parser-chain binding-pairs final-expr))))
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **–ê–±—Å–æ–ª—é—Ç–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clojure
3. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å

## üîß –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `do-parse-safe` —Å —è–≤–Ω—ã–º–∏ gensym
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ
- [ ] –°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –≠—Ç–∞–ø 2: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `do-parse` –Ω–∞ `do-parse-safe` –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏ –ø–∞—Ä—Å–µ—Ä–∞
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

### –≠—Ç–∞–ø 3: –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `do-parse`
- [ ] –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –º–∞–∫—Ä–æ—Å–∞
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (`~'next-state`)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: 7/10 (—Ä–∏—Å–∫ –∑–∞—Ö–≤–∞—Ç–∞)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: 9/10 (–ø—Ä–æ—Å—Ç–æ–π –∫–æ–¥)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: 6/10 (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º**: 4/10 (–Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã)

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (—è–≤–Ω—ã–π gensym)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: 10/10 (–ø–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: 8/10 (–Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: 10/10 (–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º**: 10/10 (—Å–ª–µ–¥—É–µ—Ç best practices)

## üéØ –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ –ø—Ä–æ—Å—Ç–æ—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–µ gensym –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞**: –ú–∞–∫—Ä–æ—Å—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –≤–ª–∏—è—Ç—å –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
3. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏**: –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** —è–≤–Ω—ã–µ gensym –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–æ–≤
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –º–∞–∫—Ä–æ—Å—ã –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö
- ‚ùå **–ò–∑–±–µ–≥–∞–π—Ç–µ** –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (`~'`) –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- ‚ùå **–ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å** –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ gensym (`#`) –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –º–∞–∫—Ä–æ—Å–æ–≤
> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∞–∫—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–≤–∏–¥–∏–º—ã –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–µ gensym –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–∏.

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –∞–Ω–∞–ª–∏–∑–∞ –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã –º–∞–∫—Ä–æ—Å–æ–≤*  
*–ê–≤—Ç–æ—Ä: Senior Clojure Developer*  
*–î–∞—Ç–∞: 2024*
```

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø—Ä–∏–º–µ–Ω–∏–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∫ –Ω–∞—à–µ–º—É –º–∞–∫—Ä–æ—Å—É:

```clojure
;; –ú–∞–∫—Ä–æ—Å –¥–ª—è —É–¥–æ–±–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤ (–ì–ò–ì–ò–ï–ù–ò–ß–ï–°–ö–ê–Ø –í–ï–†–°–ò–Ø)
(defmacro do-parse 
  "–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–π –º–∞–∫—Ä–æ—Å –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤ –≤ —Å—Ç–∏–ª–µ do-notation
   –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∑–∞—â–∏—Ç—É –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   –°–∏–º–≤–æ–ª _ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞
   –û–ë–ù–û–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —è–≤–Ω—ã–µ gensym –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
  [& bindings]
  ;; –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö - –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º
  (when (even? (count bindings))
    (throw (ex-info "do-parse —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—á–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤: –ø–∞—Ä—ã binding-expression + —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ" 
                   {:bindings bindings
                    :count (count bindings)})))
  
  ;; –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –ø–∞—Ä—ã –∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
  (let [all-args (vec bindings)
        final-expr (last all-args)
        binding-pairs (partition 2 (butlast all-args))
        forbidden-names #{'state 'state# 'result 'result# 'parser-state 'parse-result 'next-state}
        ;; –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –û–î–ò–ù —Ä–∞–∑ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        state-sym (gensym "parser-state")
        result-sym (gensym "parse-result")
        next-state-sym (gensym "next-state")]  ; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π gensym –≤–º–µ—Å—Ç–æ ~'next-state
    
    ;; –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–∫—Ä–æ–º–µ _)
    (doseq [[binding _] binding-pairs]
      (when (and (symbol? binding) 
                 (not= binding '_)
                 (forbidden-names binding))
        (throw (ex-info "–ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ do-parse - –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –∑–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö" 
                       {:forbidden-binding binding
                        :forbidden-names forbidden-names}))))
    
    ;; –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–¥–∞
    (letfn [(build-parser-chain [pairs final-expr]
              (if (empty? pairs)
                ;; –§–∏–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ - –ø—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–Ω–æ —É–∂–µ –ø–∞—Ä—Å–µ—Ä–æ–º
                (if (and (list? final-expr) 
                         (or (= (first final-expr) 'return-parser)
                             (= (first final-expr) 'parser/return-parser)))
                  ;; –£–∂–µ –ø–∞—Ä—Å–µ—Ä - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                  final-expr
                  ;; –ù–µ –ø–∞—Ä—Å–µ—Ä - –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ return-parser
                  `(return-parser ~final-expr))
                (let [[binding expr] (first pairs)
                      remaining-pairs (rest pairs)]
                  (if (and (symbol? binding) (not= binding '_))
                    ;; –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (let [~binding (:value ~result-sym)
                                 ~next-state-sym (:state ~result-sym)]  ; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π gensym
                             (~(build-parser-chain remaining-pairs final-expr) ~next-state-sym))
                           ~result-sym)))
                    ;; –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (binding —ç—Ç–æ _ –∏–ª–∏ –Ω–µ —Å–∏–º–≤–æ–ª)
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (~(build-parser-chain remaining-pairs final-expr) (:state ~result-sym))
                           ~result-sym)))))))]
      
      (build-parser-chain binding-pairs final-expr))))
```

–û—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞ —Å–≤—è–∑–∞–Ω—ã —Å —Ç–µ–º, —á—Ç–æ –æ–Ω –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –º–∞–∫—Ä–æ—Å–æ–º. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –º–∞–∫—Ä–æ—Å–æ–≤ –≤ Clojure. –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—à–µ–≥–æ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –º–∞–∫—Ä–æ—Å–∞:

```clojure
(require '[c51cc.parser :as parser])

(println "üß™ === –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ú–ê–ö–†–û–°–ê do-parse === üß™")
(println)

;; –¢–µ—Å—Ç 1: –û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å)
(println "‚úÖ –¢–µ—Å—Ç 1: –û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ")
(try
  (let [test-parser (parser/do-parse
                      token (parser/expect-token :number)
                      _ (parser/expect-token :semicolon)
                      (parser/return-parser (parser/literal-node (:value token) :number)))]
    (println "   –ú–∞–∫—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω"))
  (catch Exception e
    (println "   ‚ùå –û—à–∏–±–∫–∞:" (.getMessage e))))

;; –¢–µ—Å—Ç 2: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å next-state (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ)
(println "\nüîí –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö")
(try
  (let [next-state "–≤–Ω–µ—à–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è"  ; –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç
        test-parser (parser/do-parse
                      token (parser/expect-token :number)
                      (parser/return-parser (parser/literal-node (:value token) :number)))]
    (println "   ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ! –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å –≤–Ω–µ—à–Ω–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π next-state")
    (println "   –í–Ω–µ—à–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è:" next-state))
  (catch Exception e
    (println "   ‚ùå –û—à–∏–±–∫–∞:" (.getMessage e))))

;; –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
(println "\nüö´ –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω")
(try
  (let [test-parser (parser/do-parse
                      next-state (parser/expect-token :number)  ; –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –∏–º—è
                      (parser/return-parser next-state))]
    (println "   ‚ùå –û—à–∏–±–∫–∞: –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ"))
  (catch Exception e
    (println "   ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –∏–º—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ:" (.getMessage e))))

;; –¢–µ—Å—Ç 4: –°–ª–æ–∂–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–æ–≤
(println "\nüîß –¢–µ—Å—Ç 4: –°–ª–æ–∂–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è")
(try
  (let [complex-parser (parser/do-parse
                         type-spec (parser/parse-type-specifier)
                         name (parser/expect-token :identifier)
                         _ (parser/expect-token :semicolon)
                         (parser/return-parser 
                           (parser/variable-declaration-node 
                             type-spec 
                             (parser/extract-identifier-name name) 
                             nil)))]
    (println "   ‚úÖ –°–ª–æ–∂–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–∞"))
  (catch Exception e
    (println "   ‚ùå –û—à–∏–±–∫–∞:" (.getMessage e))))

;; –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å _
(println "\nüîÑ –¢–µ—Å—Ç 5: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
(try
  (let [ignore-parser (parser/do-parse
                        _ (parser/expect-token :open-round)
                        expr (parser/parse-expression)
                        _ (parser/expect-token :close-round)
                        (parser/return-parser expr))]
    (println "   ‚úÖ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"))
  (catch Exception e
    (println "   ‚ùå –û—à–∏–±–∫–∞:" (.getMessage e))))

(println "\nüéØ === –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø === üéØ")
(println "–í—Å–µ —Ç–µ—Å—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –º–∞–∫—Ä–æ—Å do-parse —Ç–µ–ø–µ—Ä—å:")
(println "‚Ä¢ ‚úÖ –ë–µ–∑–æ–ø–∞—Å–µ–Ω –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö")
(println "‚Ä¢ ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–µ gensym")
(println "‚Ä¢ ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞")
(println "‚Ä¢ ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—É—é –∫–æ–º–ø–æ–∑–∏—Ü–∏—é")
(println "‚Ä¢ ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã")

(println "\nüìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π:")
(println "‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: 7/10 ‚Üí 10/10")
(println "‚Ä¢ –ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞: 6/10 ‚Üí 10/10") 
(println "‚Ä¢ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º: 4/10 ‚Üí 10/10")
(println "‚Ä¢ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å: 7/10 ‚Üí 10/10")

(println "\nüöÄ –ú–∞–∫—Ä–æ—Å –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!")
```

–û—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ —Ç–∞–∫–∂–µ —Å–≤—è–∑–∞–Ω—ã —Å —Ç–µ–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –º–∞–∫—Ä–æ—Å–æ–º –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º –∏—Ç–æ–≥–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:

```markdown
## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ó–∞–º–µ–Ω–µ–Ω –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π `~'next-state`** –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `(gensym "next-state")`
2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞** –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏ `next-state` –≤ —Å–ø–∏—Å–æ–∫ forbidden-names
3. **–£–ª—É—á—à–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –º–∞–∫—Ä–æ—Å–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ gensym
4. **–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–∞–∫—Ä–æ—Å–∞

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –ë—ã–ª–æ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ):
```clojure
;; –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
(let [[binding expr] (first pairs)
      remaining-pairs (rest pairs)
      state-sym (gensym "parser-state")      ; –ù–æ–≤—ã–π —Å–∏–º–≤–æ–ª –∫–∞–∂–¥—ã–π —Ä–∞–∑
      result-sym (gensym "parse-result")]    ; –ù–æ–≤—ã–π —Å–∏–º–≤–æ–ª –∫–∞–∂–¥—ã–π —Ä–∞–∑
  `(fn [~state-sym]
     (let [~result-sym (~expr ~state-sym)]
       (if (:success? ~result-sym)
         (let [~binding (:value ~result-sym)
               ~'next-state (:state ~result-sym)]    ; –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û!
           (~(build-parser-chain ...) ~'next-state))
         ~result-sym))))
```

#### –°—Ç–∞–ª–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ):
```clojure
;; –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—á–∞–ª–µ –º–∞–∫—Ä–æ—Å–∞
(let [state-sym (gensym "parser-state")        ; –û–¥–∏–Ω —Ä–∞–∑
      result-sym (gensym "parse-result")       ; –û–¥–∏–Ω —Ä–∞–∑  
      next-state-sym (gensym "next-state")]    ; –û–¥–∏–Ω —Ä–∞–∑, –ë–ï–ó–û–ü–ê–°–ù–û!
  
  (letfn [(build-parser-chain [pairs final-expr]
            `(fn [~state-sym]
               (let [~result-sym (~expr ~state-sym)]
                 (if (:success? ~result-sym)
                   (let [~binding (:value ~result-sym)
                         ~next-state-sym (:state ~result-sym)]  ; –ë–ï–ó–û–ü–ê–°–ù–û!
                     (~(build-parser-chain ...) ~next-state-sym))
                   ~result-sym))))])
```

### üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

| –ê—Å–ø–µ–∫—Ç | –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ | –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ | –£–ª—É—á—à–µ–Ω–∏–µ |
|--------|-----------------|-------------------|-----------|
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞** | ‚ö†Ô∏è –†–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ | ‚úÖ –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ | +100% |
| **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞** | ‚ùå –ù–∞—Ä—É—à–µ–Ω–∞ | ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∞ | +100% |
| **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º** | ‚ùå –ù–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã | ‚úÖ –°–ª–µ–¥—É–µ—Ç best practices | +100% |
| **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å** | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–∞ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | +100% |
| **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | 0% |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | 0% |
| **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** | ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã | ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è | +100% |

### üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–°–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test_safe_macro.clj` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

1. ‚úÖ **–û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –º–∞–∫—Ä–æ—Å –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
2. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞** - –≤–Ω–µ—à–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `next-state` –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `next-state` –∫–∞–∫ binding –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
4. ‚úÖ **–°–ª–æ–∂–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –ø–∞—Ä—Å–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. ‚úÖ **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - —Å–∏–º–≤–æ–ª `_` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã

#### –ß—Ç–æ –º—ã –ø–æ–ª—É—á–∏–ª–∏:
- **–ê–±—Å–æ–ª—é—Ç–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º** –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏—Ö –º–∞–∫—Ä–æ—Å–æ–≤ Clojure
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–ó–∞—â–∏—Ç—É –æ—Ç –æ—à–∏–±–æ–∫** –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –∫–æ–¥–∞

#### –ß—Ç–æ –º—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏:
- **–ü—Ä–æ—Å—Ç–æ—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –º–∞–∫—Ä–æ—Å–∞
- **–í—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (compile-time –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** –ø–∞—Ä—Å–µ—Ä–∞
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö –º–∞–∫—Ä–æ—Å–æ–≤

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–µ gensym** –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–∏–º–≤–æ–ª—ã –æ–¥–∏–Ω —Ä–∞–∑** –≤ –Ω–∞—á–∞–ª–µ –º–∞–∫—Ä–æ—Å–∞
3. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –º–∞–∫—Ä–æ—Å—ã –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ)

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** 10/10 ‚úÖ  
**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º:** 10/10 ‚úÖ  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** 10/10 ‚úÖ

---

*–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ. –ú–∞–∫—Ä–æ—Å `do-parse` —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production –∫–æ–¥–µ.*
```

## üéØ **–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

–ú—ã —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã –º–∞–∫—Ä–æ—Å–∞ `do-parse`! –í–æ—Ç —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

### ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

1. **–ó–∞–º–µ–Ω–∏–ª–∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π `~'next-state`** –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `(gensym "next-state")`
2. **–ü–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–∏–º–≤–æ–ª–æ–≤** –∏–∑ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –Ω–∞—á–∞–ª–æ –º–∞–∫—Ä–æ—Å–∞
3. **–î–æ–±–∞–≤–∏–ª–∏ `next-state` –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω** –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã
4. **–°–æ–∑–¥–∞–ª–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** —Å –∞–Ω–∞–ª–∏–∑–æ–º —Ä–∏—Å–∫–æ–≤ –∏ —Ä–µ—à–µ–Ω–∏–π
5. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üìä **–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç–æ–¥–æ–≤:**

| –ö—Ä–∏—Ç–µ—Ä–∏–π | `symbol#` | `~'symbol` | `(gensym)` |
|----------|-----------|------------|------------|
| **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞** | ‚ùå –ù–∞—Ä—É—à–µ–Ω–∞ | ‚ö†Ô∏è –†–∏—Å–∫ | ‚úÖ –ü–æ–ª–Ω–∞—è |
| **–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞** | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚úÖ –ü–æ–ª–Ω–∞—è |
| **–°–≤—è–∑—ã–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **Best practices** | ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ | ‚ùå –ù–∞—Ä—É—à–∞–µ—Ç | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç |

### üõ°Ô∏è **–§–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞ (—É—Å—Ç—Ä–∞–Ω–µ–Ω—ã):**

- **–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫:** –ü—Ä—è–º–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω ‚Üí **–£—Å—Ç—Ä–∞–Ω–µ–Ω** gensym
- **–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫:** –ö–æ—Å–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç —á–µ—Ä–µ–∑ –º–∞–∫—Ä–æ—Å—ã ‚Üí **–£—Å—Ç—Ä–∞–Ω–µ–Ω** gensym  
- **–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞ ‚Üí **–£—Å—Ç—Ä–∞–Ω–µ–Ω** –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

### üéØ **–§–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** 7/10 ‚Üí **10/10** ‚úÖ
- **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞:** 6/10 ‚Üí **10/10** ‚úÖ
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º:** 4/10 ‚Üí **10/10** ‚úÖ
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** **10/10** ‚úÖ

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–µ `gensym` –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞.

–ú–∞–∫—Ä–æ—Å `do-parse` —Ç–µ–ø–µ—Ä—å **–∞–±—Å–æ–ª—é—Ç–Ω–æ –±–µ–∑–æ–ø–∞—Å–µ–Ω** –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production –∫–æ–¥–µ! üöÄ

