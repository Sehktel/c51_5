# –û—Ç—á–µ—Ç –æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ —Ñ—É–Ω–∫—Ü–∏–π –ø–∞—Ä—Å–µ—Ä–∞ C51

## üéØ –¶–µ–ª—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞–∫—Ä–æ—Å–∞ `do-parse` –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞:

- `parse-type-specifier`
- `parse-postfix-expression` 
- `parse-unary-expression`
- `parse-multiplicative-expression`

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### 1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ—É–Ω–∫—Ü–∏–π

#### `parse-type-specifier`
**–î–æ:** 12 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, 4 —É—Ä–æ–≤–Ω—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏, 2 if-–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
```clojure
(defn parse-type-specifier [state]
  (let [signedness-result ((optional (choice ...)) state)]
    (if (:success? signedness-result)
      (let [base-type-result ((choice ...) (:state signedness-result))]
        (if (:success? base-type-result)
          (success {...} (:state base-type-result))
          base-type-result))
      signedness-result)))
```

**–ü–æ—Å–ª–µ:** 8 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, 1 —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏, 0 if-–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
```clojure
(defn parse-type-specifier [state]
  ((do-parse
     signedness (optional (choice ...))
     base-type (choice ...)
     (return-parser {...})) state))
```

#### `parse-unary-expression`
**–î–æ:** 35 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å, 10 if-–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
**–ü–æ—Å–ª–µ:** 20 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, –ª–∏–Ω–µ–π–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, 0 if-–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `choice` —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ `do-parse` –±–ª–æ–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–Ω–∞—Ä–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.

#### `parse-postfix-expression`
**–î–æ:** 45 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å —Ü–∏–∫–ª–∞–º–∏
**–ü–æ—Å–ª–µ:** 25 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ —Å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `parse-function-call-args` - –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
- `parse-array-index` - –ø–∞—Ä—Å–∏–Ω–≥ –∏–Ω–¥–µ–∫—Å–æ–≤ –º–∞—Å—Å–∏–≤–∞
- `apply-postfix-operators` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç—Ñ–∏–∫—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

#### `parse-multiplicative-expression`
**–î–æ:** 18 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–µ–≤–æ–∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
**–ü–æ—Å–ª–µ:** 8 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π

–°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `parse-left-associative-binary` –¥–ª—è –≤—Å–µ—Ö –ª–µ–≤–æ–∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤.

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

- **test-simple.clj** - –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **test-refactoring.clj** - –ø–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- **refactoring-demo.clj** - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **–û–±—â–µ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞:** 44% (—Å 110 –¥–æ 61 —Å—Ç—Ä–æ–∫–∏)
- **–≠–∫–æ–Ω–æ–º–∏—è:** 49 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏:** 66-80% –≤ —Å—Ä–µ–¥–Ω–µ–º
- **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ if-–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤:** 75-100%

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –õ–∏–Ω–µ–π–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–µ –º–∞–∫—Ä–æ—Å—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –∑–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

### –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏:
- **parse-type-specifier:** +6 –±–∞–ª–ª–æ–≤ (—Å 3 –¥–æ 9)
- **parse-postfix-expression:** +6 –±–∞–ª–ª–æ–≤ (—Å 2 –¥–æ 8)
- **parse-unary-expression:** +7 –±–∞–ª–ª–æ–≤ (—Å 2 –¥–æ 9)
- **parse-multiplicative-expression:** +5 –±–∞–ª–ª–æ–≤ (—Å 4 –¥–æ 9)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```
üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø–∞—Ä—Å–µ—Ä–∞...

1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–µ–∫—Å–µ—Ä–∞:
‚úÖ –õ–µ–∫—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç

2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ parse-type-specifier:
‚úÖ parse-type-specifier —Ä–∞–±–æ—Ç–∞–µ—Ç
–†–µ–∑—É–ª—å—Ç–∞—Ç: {:signedness :unsigned, :base-type :int}

3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ parse-unary-expression:
‚úÖ parse-unary-expression —Ä–∞–±–æ—Ç–∞–µ—Ç

4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ parse-postfix-expression:
‚úÖ parse-postfix-expression —Ä–∞–±–æ—Ç–∞–µ—Ç

5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ parse-multiplicative-expression:
‚úÖ parse-multiplicative-expression —Ä–∞–±–æ—Ç–∞–µ—Ç
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–∞–∫—Ä–æ—Å–∞ `do-parse` –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏–ª:

1. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** - –ª–∏–Ω–µ–π–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–º–µ—Å—Ç–æ –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
2. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –º–µ–Ω—å—à–µ boilerplate –∫–æ–¥–∞
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏–µ –º–∞–∫—Ä–æ—Å—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** - –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞

–ö–æ–¥ —Å—Ç–∞–ª –±–æ–ª–µ–µ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Clojure.

## üìÅ –§–∞–π–ª—ã

- `src/c51cc/parser.clj` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ø–∞—Ä—Å–µ—Ä–∞ —Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- `test-simple.clj` - –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
- `test-refactoring.clj` - –ø–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞  
- `refactoring-demo.clj` - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π
- `REFACTORING_SUMMARY.md` - —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
clojure -M test-simple.clj

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏–π
clojure -M refactoring-demo.clj

# –ü–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)
clojure -M test-refactoring.clj
``` 