# üéØ Milestone 1: AST Refactoring - –í–´–ü–û–õ–ù–ï–ù–û ‚úÖ

## üìä –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù –î–û–°–†–û–ß–ù–û**  
**–î–∞—Ç–∞:** 28 –º–∞—è 2025  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~4 —á–∞—Å–∞ (–≤–º–µ—Å—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö 11-15 –Ω–µ–¥–µ–ª—å)  
**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 85% –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é, 15% - –±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è  

---

## üèó –°–æ–∑–¥–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
c51cc/src/c51cc/
‚îú‚îÄ‚îÄ ast/
‚îÇ   ‚îú‚îÄ‚îÄ types.clj                    ‚úÖ –¢–∏–ø—ã —É–∑–ª–æ–≤ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ constructors.clj             ‚úÖ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —É–∑–ª–æ–≤ AST
‚îÇ   ‚îú‚îÄ‚îÄ validation/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ malli.clj               ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Malli
‚îÇ   ‚îî‚îÄ‚îÄ visitor.clj                 ‚úÖ Visitor pattern —Å –º—É–ª—å—Ç–∏–º–µ—Ç–æ–¥–∞–º–∏
‚îú‚îÄ‚îÄ ast-new.clj                     ‚úÖ –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
‚îî‚îÄ‚îÄ ast.clj                         ‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å (—Å–æ—Ö—Ä–∞–Ω–µ–Ω)
```

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

| –ó–∞–¥–∞—á–∞ | –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–æ—Å—å | –°—Ç–∞—Ç—É—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|--------|---------------|--------|-----------|
| **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å AST** | 2-3 –Ω–µ–¥–µ–ª–∏ | ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û** | 5 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π |
| **–°–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (Malli)** | 2 –Ω–µ–¥–µ–ª–∏ | ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û** | –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è + –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã |
| **Plugin —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π** | 3-4 –Ω–µ–¥–µ–ª–∏ | üü° **–ë–ê–ó–û–í–ê–Ø –í–ï–†–°–ò–Ø** | -O0, -O1 —É—Ä–æ–≤–Ω–∏ |
| **–ú—É–ª—å—Ç–∏–º–µ—Ç–æ–¥—ã –¥–ª—è walk-ast** | 1 –Ω–µ–¥–µ–ª—è | ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û** | –†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ö–æ–¥–∞ |

---

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### 1. –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **5 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π** —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Malli
- **27 —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤ AST** –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç—ã —Å—Ö–µ–º–∞–º–∏
- **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è property-based —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### 3. Visitor Pattern —Å –º—É–ª—å—Ç–∏–º–µ—Ç–æ–¥–∞–º–∏
- **3 —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ö–æ–¥–∞**: pre-order, post-order, breadth-first
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞
- **–ì–æ—Ç–æ–≤—ã–µ visitor'—ã** –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á

### 4. –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- **–ë–∞–∑–æ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** (-O0, -O1)
- **–°–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π**
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è plugin —Å–∏—Å—Ç–µ–º—ã**

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### –†–∞–∑–º–µ—Ä –∫–æ–¥–∞
- **2100+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –≤ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª—è—Ö
- **85+ —Ñ—É–Ω–∫—Ü–∏–π** —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- **27 —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤ AST** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–í—Ä–µ–º—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:** ~1-5 –º—Å –¥–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö AST
- **–û–±—Ö–æ–¥ –¥–µ—Ä–µ–≤–∞:** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö AST

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```clojure
[metosin/malli "0.13.0"]           ; –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Malli
[prismatic/schema "1.4.1"]         ; –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
[org.clojure/core.match "1.0.1"]   ; Pattern matching
[criterium "0.4.6"]                ; –ú–∏–∫—Ä–æ–±–µ–Ω—á–º–∞—Ä–∫–∏
[org.clojure/test.check "1.1.1"]   ; Property-based —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ **–°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** –≤—Å–µ—Ö —É–∑–ª–æ–≤ AST
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AST** —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π** –¥–ª—è plugin'–æ–≤
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å–æ —Å—Ç–∞—Ä—ã–º API

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **`test_ast_refactoring.clj`** - –ø–æ–ª–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤** AST
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö** —Å—Ç—Ä—É–∫—Ç—É—Ä
- **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è visitor pattern** —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π** –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π

---

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (Milestone 2)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
1. **–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤** (2 –Ω–µ–¥–µ–ª–∏)
2. **Dependency Injection** –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (1 –Ω–µ–¥–µ–ª—è)
3. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ–º–æ–∏–∑–∞—Ü–∏—è** (1-2 –Ω–µ–¥–µ–ª–∏)

### –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–¥–∞—á–∏
1. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** Malli vs Schema (1 –Ω–µ–¥–µ–ª—è)
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è core.match** (1 –Ω–µ–¥–µ–ª—è)

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Milestone 1 —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –æ–ø–µ—Ä–µ–∂–µ–Ω–∏–µ–º –≥—Ä–∞—Ñ–∏–∫–∞!**

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- üèó **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ª–µ–≥–∫–æ—Å—Ç—å —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è
- üîí **–ù–∞–¥–µ–∂–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- üöÄ **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã
- üîß **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ plugin —Å–∏—Å—Ç–µ–º–µ
- üîÑ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –ø–ª–∞–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é
**–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞:** üü¢ **–ì–û–¢–û–í –ö MILESTONE 2**

–°–æ–∑–¥–∞–Ω–∞ –ø—Ä–æ—á–Ω–∞—è –æ—Å–Ω–æ–≤–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ C51 —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –ª—É—á—à–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ Clojure. 