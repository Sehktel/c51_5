# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã `next-state` –∏ –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã –º–∞–∫—Ä–æ—Å–æ–≤

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –º–∞–∫—Ä–æ—Å–µ `do-parse`

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –º–∞–∫—Ä–æ—Å–µ `do-parse` –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã.

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º—ã

–í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –º–∞–∫—Ä–æ—Å–∞ `do-parse` –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –≤—ã–±–æ—Ä–æ–º –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:

### –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
```clojure
;; –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω—ã–π –∫–æ–¥ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º gensym:
`(let [~binding (:value ~result-sym)
       next-state# (:state ~result-sym)]           ; –û–¥–∏–Ω —Å–∏–º–≤–æ–ª
   (~(build-parser-chain ...) next-state#))       ; –î–†–£–ì–û–ô —Å–∏–º–≤–æ–ª!
```

### –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
```clojure
;; –¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–∏–º–≤–æ–ª–æ–º:
`(let [~binding (:value ~result-sym)
       ~'next-state (:state ~result-sym)]         ; –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è
   (~(build-parser-chain ...) ~'next-state))     ; –¢–æ –∂–µ –∏–º—è
```

## üîç –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–¥–æ–≤

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π gensym (`symbol#`)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
```clojure
;; –ö–∞–∂–¥–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ symbol# —Å–æ–∑–¥–∞–µ—Ç –ù–û–í–´–ô —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
`(let [var# 42]      ; var__1234__auto__
   (println var#))   ; var__5678__auto__ - –î–†–£–ì–û–ô —Å–∏–º–≤–æ–ª!
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ö–∞–∂–¥–æ–µ `#` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —á–∞—Å—Ç—è–º–∏ –º–∞–∫—Ä–æ—Å–∞
- –ü–æ–¥—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### 2. –ù–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª (`~'symbol`)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
```clojure
;; –°–æ–∑–¥–∞–µ—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–∏–º–≤–æ–ª –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
`(let [~'var 42]     ; var
   (println ~'var))  ; var - —Ç–æ—Ç –∂–µ —Å–∏–º–≤–æ–ª
```

**–†–∏—Å–∫–∏:**
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∑–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã –º–∞–∫—Ä–æ—Å–∞
- –ú–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

### 3. –Ø–≤–Ω—ã–π gensym (`(gensym "prefix")`)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
```clojure
;; –°–æ–∑–¥–∞–µ–º —Å–∏–º–≤–æ–ª –æ–¥–∏–Ω —Ä–∞–∑, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ–∑–¥–µ
(let [var-sym (gensym "var")]
  `(let [~var-sym 42]     ; var1234
     (println ~var-sym))) ; var1234 - —Ç–æ—Ç –∂–µ —Å–∏–º–≤–æ–ª
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü–æ–ª–Ω–∞—è –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º–µ–Ω
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–µ—Ç–æ–¥–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π gensym (`#`) | –ù–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (`~'`) | –Ø–≤–Ω—ã–π gensym |
|----------|----------------------------|---------------------------|--------------|
| **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞** | ‚ùå –ù–∞—Ä—É—à–µ–Ω–∞ (—Ä–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã) | ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∞ | ‚úÖ –ü–æ–ª–Ω–∞—è |
| **–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞** | ‚úÖ –ü–æ–ª–Ω–∞—è (–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç) | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚úÖ –ü–æ–ª–Ω–∞—è |
| **–°–≤—è–∑—ã–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚ö†Ô∏è –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | ‚ö†Ô∏è –†–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ | ‚úÖ –ê–±—Å–æ–ª—é—Ç–Ω–∞—è |
| **Best practices** | ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | ‚ùå –ù–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã | ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç |

## üö® –ê–Ω–∞–ª–∏–∑ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —Ä–∏—Å–∫–∞

### –†–∏—Å–∫–∏ –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ (`~'next-state`)

#### –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
```clojure
;; –ü—Ä—è–º–æ–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º–µ–Ω
(let [next-state "–≤–Ω–µ—à–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è"]
  (do-parse
    token (expect-token :number)
    (return-parser token)))  ; next-state –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞!
```

#### –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫
```clojure
;; –ö–æ—Å–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç —á–µ—Ä–µ–∑ –º–∞–∫—Ä–æ—Å—ã
(defmacro user-macro []
  `(let [~'next-state "–∫–æ–Ω—Ñ–ª–∏–∫—Ç"]
     (some-parser-function)))
```

#### –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫
```clojure
;; –û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
(defn parse-expression [state]
  (do-parse
    token (expect-token :number)
    (return-parser (literal-node (:value token) :number))))
```

### –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

| –°—Ü–µ–Ω–∞—Ä–∏–π | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å | –û–±—â–∏–π —Ä–∏—Å–∫ |
|----------|-------------|-------------|------------|
| **–ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `next-state`** | –ù–∏–∑–∫–∞—è (5%) | –í—ã—Å–æ–∫–∞—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π |
| **–ö–æ–Ω—Ñ–ª–∏–∫—Ç —á–µ—Ä–µ–∑ –º–∞–∫—Ä–æ—Å—ã** | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è (1%) | –í—ã—Å–æ–∫–∞—è | ‚ö†Ô∏è –ù–∏–∑–∫–∏–π |
| **–û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞** | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è (0.1%) | –ù–∏–∑–∫–∞—è | ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π |
| **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞** | –°—Ä–µ–¥–Ω—è—è (20%) | –°—Ä–µ–¥–Ω—è—è | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π |

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –Ø–≤–Ω—ã–π gensym

### –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–∫—Ä–æ—Å–∞

```clojure
(defmacro do-parse-safe
  "–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è do-parse —Å —è–≤–Ω—ã–º–∏ gensym"
  [& bindings]
  ;; –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  (when (even? (count bindings))
    (throw (ex-info "do-parse —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—á–µ—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤" 
                   {:bindings bindings})))
  
  (let [all-args (vec bindings)
        final-expr (last all-args)
        binding-pairs (partition 2 (butlast all-args))
        ;; –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –û–î–ò–ù —Ä–∞–∑
        state-sym (gensym "parser-state")
        result-sym (gensym "parse-result")
        next-state-sym (gensym "next-state")]  ; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∏–º–≤–æ–ª
    
    (letfn [(build-parser-chain [pairs final-expr]
              (if (empty? pairs)
                (if (and (list? final-expr) 
                         (= (first final-expr) 'return-parser))
                  final-expr
                  `(return-parser ~final-expr))
                (let [[binding expr] (first pairs)
                      remaining-pairs (rest pairs)]
                  (if (and (symbol? binding) (not= binding '_))
                    ;; –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (let [~binding (:value ~result-sym)
                                 ~next-state-sym (:state ~result-sym)]  ; –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π gensym
                             (~(build-parser-chain remaining-pairs final-expr) ~next-state-sym))
                           ~result-sym)))
                    ;; –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    `(fn [~state-sym]
                       (let [~result-sym (~expr ~state-sym)]
                         (if (:success? ~result-sym)
                           (~(build-parser-chain remaining-pairs final-expr) (:state ~result-sym))
                           ~result-sym)))))))]
      
      (build-parser-chain binding-pairs final-expr))))
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **–ê–±—Å–æ–ª—é—Ç–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clojure
3. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å

## üîß –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `do-parse-safe` —Å —è–≤–Ω—ã–º–∏ gensym
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ
- [ ] –°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –≠—Ç–∞–ø 2: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `do-parse` –Ω–∞ `do-parse-safe` –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —á–∞—Å—Ç–∏ –ø–∞—Ä—Å–µ—Ä–∞
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

### –≠—Ç–∞–ø 3: –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `do-parse`
- [ ] –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –º–∞–∫—Ä–æ—Å–∞
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (`~'next-state`)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: 7/10 (—Ä–∏—Å–∫ –∑–∞—Ö–≤–∞—Ç–∞)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: 9/10 (–ø—Ä–æ—Å—Ç–æ–π –∫–æ–¥)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: 6/10 (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã)
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º**: 4/10 (–Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã)

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (—è–≤–Ω—ã–π gensym)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: 10/10 (–ø–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: 8/10 (–Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ)
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: 10/10 (–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º**: 10/10 (—Å–ª–µ–¥—É–µ—Ç best practices)

## üéØ –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ –ø—Ä–æ—Å—Ç–æ—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–µ gensym –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞**: –ú–∞–∫—Ä–æ—Å—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –≤–ª–∏—è—Ç—å –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
3. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏**: –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** —è–≤–Ω—ã–µ gensym –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–∞–∫—Ä–æ—Å–æ–≤
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –º–∞–∫—Ä–æ—Å—ã –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö
- ‚ùå **–ò–∑–±–µ–≥–∞–π—Ç–µ** –Ω–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (`~'`) –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- ‚ùå **–ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å** –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ gensym (`#`) –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –º–∞–∫—Ä–æ—Å–æ–≤
> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∞–∫—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–≤–∏–¥–∏–º—ã –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–µ gensym –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–∏.

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ó–∞–º–µ–Ω–µ–Ω –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π `~'next-state`** –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `(gensym "next-state")`
2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞** –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏ `next-state` –≤ —Å–ø–∏—Å–æ–∫ forbidden-names
3. **–£–ª—É—á—à–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –º–∞–∫—Ä–æ—Å–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ gensym
4. **–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–∞–∫—Ä–æ—Å–∞

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –ë—ã–ª–æ (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ):
```clojure
;; –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
(let [[binding expr] (first pairs)
      remaining-pairs (rest pairs)
      state-sym (gensym "parser-state")      ; –ù–æ–≤—ã–π —Å–∏–º–≤–æ–ª –∫–∞–∂–¥—ã–π —Ä–∞–∑
      result-sym (gensym "parse-result")]    ; –ù–æ–≤—ã–π —Å–∏–º–≤–æ–ª –∫–∞–∂–¥—ã–π —Ä–∞–∑
  `(fn [~state-sym]
     (let [~result-sym (~expr ~state-sym)]
       (if (:success? ~result-sym)
         (let [~binding (:value ~result-sym)
               ~'next-state (:state ~result-sym)]    ; –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û!
           (~(build-parser-chain ...) ~'next-state))
         ~result-sym))))
```

#### –°—Ç–∞–ª–æ (–±–µ–∑–æ–ø–∞—Å–Ω–æ):
```clojure
;; –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—á–∞–ª–µ –º–∞–∫—Ä–æ—Å–∞
(let [state-sym (gensym "parser-state")        ; –û–¥–∏–Ω —Ä–∞–∑
      result-sym (gensym "parse-result")       ; –û–¥–∏–Ω —Ä–∞–∑  
      next-state-sym (gensym "next-state")]    ; –û–¥–∏–Ω —Ä–∞–∑, –ë–ï–ó–û–ü–ê–°–ù–û!
  
  (letfn [(build-parser-chain [pairs final-expr]
            `(fn [~state-sym]
               (let [~result-sym (~expr ~state-sym)]
                 (if (:success? ~result-sym)
                   (let [~binding (:value ~result-sym)
                         ~next-state-sym (:state ~result-sym)]  ; –ë–ï–ó–û–ü–ê–°–ù–û!
                     (~(build-parser-chain ...) ~next-state-sym))
                   ~result-sym))))])
```

### üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

| –ê—Å–ø–µ–∫—Ç | –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ | –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ | –£–ª—É—á—à–µ–Ω–∏–µ |
|--------|-----------------|-------------------|-----------|
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞** | ‚ö†Ô∏è –†–∏—Å–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ | ‚úÖ –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ | +100% |
| **–ì–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–æ—Ç–∞** | ‚ùå –ù–∞—Ä—É—à–µ–Ω–∞ | ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∞ | +100% |
| **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º** | ‚ùå –ù–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã | ‚úÖ –°–ª–µ–¥—É–µ—Ç best practices | +100% |
| **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å** | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–∞ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | +100% |
| **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | 0% |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è | 0% |
| **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** | ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã | ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è | +100% |

### üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–°–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test_safe_macro.clj` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

1. ‚úÖ **–û–±—ã—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –º–∞–∫—Ä–æ—Å –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
2. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞** - –≤–Ω–µ—à–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `next-state` –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `next-state` –∫–∞–∫ binding –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
4. ‚úÖ **–°–ª–æ–∂–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –ø–∞—Ä—Å–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. ‚úÖ **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - —Å–∏–º–≤–æ–ª `_` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã

#### –ß—Ç–æ –º—ã –ø–æ–ª—É—á–∏–ª–∏:
- **–ê–±—Å–æ–ª—é—Ç–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –æ—Ç –∑–∞—Ö–≤–∞—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º** –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–∏—Ö –º–∞–∫—Ä–æ—Å–æ–≤ Clojure
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–ó–∞—â–∏—Ç—É –æ—Ç –æ—à–∏–±–æ–∫** –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –∫–æ–¥–∞

#### –ß—Ç–æ –º—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏:
- **–ü—Ä–æ—Å—Ç–æ—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –º–∞–∫—Ä–æ—Å–∞
- **–í—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (compile-time –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** –ø–∞—Ä—Å–µ—Ä–∞
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

### üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö –º–∞–∫—Ä–æ—Å–æ–≤

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–µ gensym** –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
2. **–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–∏–º–≤–æ–ª—ã –æ–¥–∏–Ω —Ä–∞–∑** –≤ –Ω–∞—á–∞–ª–µ –º–∞–∫—Ä–æ—Å–∞
3. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ** –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ** –º–∞–∫—Ä–æ—Å—ã –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ)

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** 10/10 ‚úÖ  
**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º:** 10/10 ‚úÖ  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** 10/10 ‚úÖ

---

*–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ. –ú–∞–∫—Ä–æ—Å `do-parse` —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production –∫–æ–¥–µ.*

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –∞–Ω–∞–ª–∏–∑–∞ –≥–∏–≥–∏–µ–Ω–∏—á–µ—Å–∫–æ–π —á–∏—Å—Ç–æ—Ç—ã –º–∞–∫—Ä–æ—Å–æ–≤*  
*–ê–≤—Ç–æ—Ä: Senior Clojure Developer*  
*–î–∞—Ç–∞: 2024* 